
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Dev Star SJ">
    <title>Archives: 2017/3 - Dev Star SJ</title>
    <meta name="author" content="Yun Seok-joon">
    
    
    
    <meta name="description" content="Sharing the common developer&apos;s try-on">
<meta property="og:type" content="blog">
<meta property="og:title" content="Dev Star SJ">
<meta property="og:url" content="http://DevStarSJ.github.io/archives/2017/03/index.html">
<meta property="og:site_name" content="Dev Star SJ">
<meta property="og:description" content="Sharing the common developer&apos;s try-on">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dev Star SJ">
<meta name="twitter:description" content="Sharing the common developer&apos;s try-on">
    
    
        
    
    
        <meta property="og:image" content="http://DevStarSJ.github.io/assets/images/sjyun.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-eoqrdyagg8lofwhg4unnxmhyxznbkxgjkodxgdtletmltlwb2wgngdrld76m.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Dev Star SJ</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Yun Seok-joon</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://DevLunaSJ.github.com/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.facebook.com/seokjoon.yun.9" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/u/1/108379332089647292574" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-google-plus"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/sjyun/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:seokjoon.yun@gmail.com" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/26/Lambda.Chatbot.01/">
                            AWS Lambda에 Python Slack Chatbot을 통해서 미세먼지 대기정보 알림이 만들기
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-26T00:00:00+09:00">
	
		    Mar 26, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/AWS/">AWS</a>, <a class="category-link" href="/categories/AWS/Lambda/">Lambda</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="AWS-Lambda에-Python-Slack-Chatbot을-통해서-미세먼지-대기정보-알림이-만들기"><a href="#AWS-Lambda에-Python-Slack-Chatbot을-통해서-미세먼지-대기정보-알림이-만들기" class="headerlink" title="AWS Lambda에 Python Slack Chatbot을 통해서 미세먼지 대기정보 알림이 만들기"></a>AWS Lambda에 Python Slack Chatbot을 통해서 미세먼지 대기정보 알림이 만들기</h1><p>Lambda를 이용해서 Slack용 Chatbot을 만들어 보았다.<br>개발언어로는 Python을 사용했다.<br>Lambda에는 Python 2.7만 지원되어서 작업하면서도 불편한 점이 많았다.<br>특히 챗봇이다보니 유니코드(한글) 처리가 필수여서다.<br>(Node.JS는 6.1까지 지원해주는데… Python도 3을 빨리 지원해주면 좋겠다.)  </p>
<p>예제로 만들어본 챗봇은 서울시 종로구의 대기상태를 알려주는 기능을 제공한다.<br>매일 아침 5시 20분(내 기상시간)과 오후 12시 20분(점심 먹으러 가기 전에 지하식당에서 먹을지 밖에 나가서 먹을지 생각하기 위해서)에 알려주도록 설정하였다.<br>솔직히 오후 12시에 굳이 20분을 한 이유는 CloudWatch의 event 생성을 편하게 하기위해서이다.<br>솔직히 12시 40분에 알려주는게 더 좋을것 같긴하지만, 그것 때문에 event를 추가로 생성하기엔 귀찮기도 하고, 관리포인트가 두군데가 생기기 때문에 그냥 20분으로 통일했다.</p>
<p>챗봇 구현을 위한 Lambda를 2개로 나누었다.</p>
<ul>
<li>Slack에 메세지를 전달해주는 Lambda</li>
<li>크롤링하여 대기상태 데이터를 뽑아내고 메세지를 만드는 Lambda</li>
</ul>
<p>크롤링 Lambda는 SNS를 통해서 메세지 전달 Lambda를 호출한다.<br>크롤링 Lambda는 CloudWatch의 event를 통해서 호출된다.  </p>
<p>그 과정을 그림으로 표현하면 아래와 같다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Chatbot.01.png?raw=true"></p>
<p>이전에 표스팅한 내용에 있는 것에 대해서는 설명을 생략하겠다.<br>해당 내용에 대해서는 아래 링크를 참고하면 관련 내용이 있다.</p>
<ul>
<li>Python 코드를 Lambda에 배포하는 방법 : <a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda.Packaging.Python.md" target="_blank" rel="external">Lambda Python Packaging</a></li>
<li>Lambda -&gt; SNS -&gt; Lambda 로 호출하는 방법 : <a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda/Lambda.invoke.Lambda.md" target="_blank" rel="external">Lambda에서 Lambda를 호출하는 방법</a></li>
</ul>
<h2 id="1-Slack에-메세지-보내기"><a href="#1-Slack에-메세지-보내기" class="headerlink" title="1. Slack에 메세지 보내기"></a>1. Slack에 메세지 보내기</h2><p>먼저 Slack Bot을 만들기 위해서는 API Token이 필요하다.<br>자세한 생성방법은 검색하면 많이 나오니깐 생략하겠다.<br>간략하게 설명없이 방법만 적겠다.  </p>
<ul>
<li>Slack에서 채널명 클릭해서 나오는 메뉴에서 <code>Apps &amp; intergrations</code> 클릭<ul>
<li><code>Bots</code> 검색해서 클릭</li>
<li><code>Add Configuration</code>클릭<ul>
<li>안내대로 쭉 설정하고 나오는 화면에서 <code>API Token</code>값을 보고 기록해 놓음</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>이제 Slack에 메세지를 보내는 Python 함수를 먼저 만들어 보자.</p>
<p>만약 Python 버전이 2.7이 아닌 경우에는 <code>virtualenv</code>를 통해서 2.7 환경으로 만들어 놓고 작업을 해야한다.<br>그 방법은 <a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda.Packaging.Python.md" target="_blank" rel="external">Lambda Python Packaging</a> 링크를 통해서 확인하기 바란다.</p>
<p><code>slacker</code>라는 패키지를 이용하면 정말 쉽게 작성이 가능하다.  </p>
<p>우리는 Lambda에 배포해야하니 <code>pip</code>로 패키지를 설치할 때 해당 폴더에 설치해야 한다.</p>
<blockquote>
<p>pip install slacker -t .</p>
</blockquote>
<p>이제 <code>index.py</code>라는 파일명으로 아래 코드를 입력한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> slacker <span class="keyword">import</span> Slacker</div><div class="line"></div><div class="line">token = <span class="string">'&#123;Slack Bot API Token&#125;'</span></div><div class="line">slack = Slacker(token)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></div><div class="line">    ch = event[<span class="string">"channel"</span>]</div><div class="line">    message = event[<span class="string">"message"</span>]</div><div class="line"></div><div class="line">    slack.chat.post_message(ch, msg)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    event= &#123;&#125;;</div><div class="line">    event[<span class="string">"channel"</span>] = <span class="string">"#general"</span>;</div><div class="line">    event[<span class="string">"message"</span>] = <span class="string">"메인 테스트"</span>;</div><div class="line">    </div><div class="line">    handler(event, <span class="keyword">None</span>);</div></pre></td></tr></table></figure>
<p>실행을 했을 때 Slack의 <code>#general</code> 채널에 메세지가 출력되면 정상적으로 동작하는 것이다.</p>
<blockquote>
<p>python index.py</p>
</blockquote>
<p> <img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Chatbot.02.png?raw=true"></p>
<p> 이제 Lambda로 올려서 테스트 해보자.</p>
<blockquote>
<p>zip -r bot.zip .</p>
</blockquote>
<p> 위 명령어로 압축을 한 후에 Lambda에 올려서 배포를 한 후 테스트 데이터를 아래와 같은 형태로 넣은 후 실행해서 Slack에 메세지가 나오면 성공한 것이다.</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"channel"</span>: <span class="string">"#general"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"람다람다 테스트"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Chatbot.03.png?raw=true"></p>
<h2 id="2-대기정보를-얻기위해서-웹-크롤링하기"><a href="#2-대기정보를-얻기위해서-웹-크롤링하기" class="headerlink" title="2. 대기정보를 얻기위해서 웹 크롤링하기"></a>2. 대기정보를 얻기위해서 웹 크롤링하기</h2><p>위에 작성한 코드와는 다른 폴더에서 작업하겠다.<br>왜냐면 다른 Lambda로 배포할 코드라 사용하지 않는 패키지까지 같이 포함되어 배포할 용량이 커지는걸 피하기 위해서다.</p>
<p>서울특별시 대기환경정보(<a href="http://cleanair.seoul.go.kr/air_city.htm?method=measure" target="_blank" rel="external">http://cleanair.seoul.go.kr/air_city.htm?method=measure</a>)에서 관련 데이터를 크롤링했다.<br>(네이버는 크롤링을 막아놔서… ㅠㅠ 아마 적절히 User-Agent값을 넣는다던지, headers 정보를 감쪽같이 속인다던지, 웹브라우저 엔진을 이용한다던지 하는 방법을 이용하면 되겠지만… 뭐 대단한 거라고 그냥 다른 곳을 선택했다. 최대한 쉽게 쉽게…)</p>
<p>웹페이지 소스를 가져오기 위해서 <code>requests</code>를 사용했으며 해당 소스를 분석하기 위해서 <code>beautifulsoup</code>를 사용하였다.<br>그동안 말로만 듣던 beautifulsoup를 처음 써봤는데, 100% 마음에 들지는 않았지만 그래도 원하는 기능들이 꽤 많이 구현되어 있었다.<br>텍스트를 한줄 한줄 읽어가면서 분석해야하는 일을 많이 줄여주었다.</p>
<blockquote>
<p>pip install requests beautifulsoup -t .</p>
</blockquote>
<p>위 페이지에서 개발자 도구를 열어서 소스도 살펴보고… 각 element 별로 클릭해서 적절한 id값도 찾아보고… 이래저래 해봤는데… 한방에 딱! 뽑아 낼 수 있는 구조가 아니다.<br>그냥 일단 받아놓고 노가다로 찾아야 겠다. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> BeautifulSoup <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">URL = <span class="string">'http://cleanair.seoul.go.kr/air_city.htm?method=measure'</span></div><div class="line"></div><div class="line">response = requests.get(URL)</div><div class="line">html_doc = response.text</div><div class="line">soup = BeautifulSoup(html_doc)</div><div class="line"></div><div class="line"><span class="keyword">print</span> soup.prettify()</div></pre></td></tr></table></figure>
<p>로 일단 찍어보자.<br>여기서 뭘 보겠다는게 아니라 그냥 일단 잘 동작하나 보자.<br>겁나 길게 html이 우루루 출력되면 성공한 것이다.  </p>
<p>다시한번 개발자 도구로 해당페이지를 보니 아래쪽 표 부분에 서울시 각 도별로 대기상태 값들이 있다.<br><code>&lt;table&gt;</code> 태그 정보들에 대해서 값을 추출해 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tables = soup.findAll(<span class="string">'table'</span>)</div><div class="line"><span class="keyword">print</span> tables</div></pre></td></tr></table></figure>
<p>3번째 테이블에 원하는 정보가 있다.</p>
<p>각 <code>&lt;tr&gt;</code>별로 살펴봐서 우리가 원하는 위치(<code>종로구</code>)에 관한 정보만 찾아보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dataTable = tables[<span class="number">2</span>]</div><div class="line">trs = dataTable.findAll(<span class="string">'tr'</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> trs:</div><div class="line">    <span class="keyword">if</span> <span class="string">'종로구'</span> <span class="keyword">in</span> str(tr):</div><div class="line">        <span class="keyword">print</span> tr;</div></pre></td></tr></table></figure>
<p>우리가 원하는 정보는 저기에 다 있는게 확인되었다.<br>이제 이걸 이용해서 메세지를 만들어서 출력해 보겠다.  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">dataTable = tables[<span class="number">2</span>]</div><div class="line">trs = dataTable.findAll(<span class="string">'tr'</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> trs:</div><div class="line">    <span class="keyword">if</span> <span class="string">'종로구'</span> <span class="keyword">in</span> str(tr):</div><div class="line">        tds = tr.findAll(<span class="string">'td'</span>)</div><div class="line"></div><div class="line">        message1 = <span class="string">u'종로구의 현재 통합대기환경지수는 &#123;&#125;(&#123;&#125;) 입니다.'</span>.format(tds[<span class="number">7</span>].getText(), tds[<span class="number">8</span>].getText())</div><div class="line">        message2 = <span class="string">u'미세먼지: &#123;&#125;㎍/㎥, 초미세먼지: &#123;&#125;㎍/㎥, 오존: &#123;&#125;ppm, 이산화질소: &#123;&#125;ppm, 일산화탄소: &#123;&#125;ppm, 아황산가스: &#123;&#125;ppm'</span>.format(tds[<span class="number">1</span>].getText(), tds[<span class="number">2</span>].getText(), tds[<span class="number">3</span>].getText(), tds[<span class="number">4</span>].getText(), tds[<span class="number">5</span>].getText(), tds[<span class="number">6</span>].getText())</div><div class="line"></div><div class="line">        messageTotal = message1 + <span class="string">u"("</span> + message2 + <span class="string">")"</span></div><div class="line">        <span class="keyword">print</span> messageTotal</div></pre></td></tr></table></figure>
<blockquote>
<p>종로구의 현재 통합대기환경지수는 보통(70) 입니다.(미세먼지: 44㎍/㎥, 초미세먼지: 25㎍/㎥, 오존: 0.036ppm, 이산화질소: 0.033ppm, 일산화탄소: 0.5ppm, 아황산가스: 0.004ppm)</p>
</blockquote>
<p>이제까지의 코드를 한번 정리해 보겠다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> BeautifulSoup <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">URL = <span class="string">'http://cleanair.seoul.go.kr/air_city.htm?method=measure'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetInfo</span><span class="params">(gu)</span>:</span></div><div class="line">    response = requests.get(URL)</div><div class="line">    html_doc = response.text</div><div class="line">    soup = BeautifulSoup(html_doc)</div><div class="line"></div><div class="line">    tables = soup.findAll(<span class="string">'table'</span>);</div><div class="line">    dataTable = tables[<span class="number">2</span>]</div><div class="line">    trs = dataTable.findAll(<span class="string">'tr'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> tr <span class="keyword">in</span> trs:</div><div class="line">        <span class="keyword">if</span> gu <span class="keyword">in</span> str(tr):</div><div class="line">            <span class="keyword">return</span> tr;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">MakeMessage</span><span class="params">(data)</span>:</span></div><div class="line">    tds = data.findAll(<span class="string">'td'</span>)</div><div class="line"></div><div class="line">    message1 = <span class="string">u'종로구의 현재 통합대기환경지수는 &#123;&#125;(&#123;&#125;) 입니다.'</span>.format(tds[<span class="number">7</span>].getText(), tds[<span class="number">8</span>].getText())</div><div class="line">    message2 = <span class="string">u'미세먼지: &#123;&#125;㎍/㎥, 초미세먼지: &#123;&#125;㎍/㎥, 오존: &#123;&#125;ppm, 이산화질소: &#123;&#125;ppm, 일산화탄소: &#123;&#125;ppm, 아황산가스: &#123;&#125;ppm'</span>.format(tds[<span class="number">1</span>].getText(), tds[<span class="number">2</span>].getText(), tds[<span class="number">3</span>].getText(), tds[<span class="number">4</span>].getText(), tds[<span class="number">5</span>].getText(), tds[<span class="number">6</span>].getText())</div><div class="line"></div><div class="line">    messageTotal = message1 + <span class="string">u"("</span> + message2 + <span class="string">")"</span></div><div class="line">    <span class="keyword">return</span> messageTotal</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    <span class="keyword">print</span> MakeMessage(GetInfo(<span class="string">'종로구'</span>))</div></pre></td></tr></table></figure>
<h2 id="3-SNS을-통해서-Slack-Lambda-호출하기"><a href="#3-SNS을-통해서-Slack-Lambda-호출하기" class="headerlink" title="3. SNS을 통해서 Slack Lambda 호출하기"></a>3. SNS을 통해서 Slack Lambda 호출하기</h2><p>자세한 설명은 <a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda/Lambda.invoke.Lambda.md" target="_blank" rel="external">Lambda에서 Lambda를 호출하는 방법</a> 링크를 통해서 확인하기 바란다.</p>
<p>해당 SNS를 통해서 메세지를 보내기 위해서 SNS의 ARN 주소를 어디에 적어 놓아야 한다.</p>
<p>SNS 에서 Lambda 로 전달되는 메세지 형태를 처리하기 위해서는 위 코드를 수정해야 한다.<br>참고로 <code>Subject</code>로 채널명을 입력받고 <code>Message</code> 전달할 메세지를 입력받도록 설정하였다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> slacker <span class="keyword">import</span> Slacker</div><div class="line"></div><div class="line">token = <span class="string">'&#123;Slack Bot API Token&#125;'</span></div><div class="line">slack = Slacker(token)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></div><div class="line">    keys = event.keys()</div><div class="line">    </div><div class="line">    ch = <span class="string">""</span></div><div class="line">    message = <span class="string">""</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> <span class="string">'channel'</span> <span class="keyword">in</span> keys:</div><div class="line">        ch = event[<span class="string">"channel"</span>]</div><div class="line">        msg = event[<span class="string">"message"</span>]</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        ch = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'Sns'</span>][<span class="string">'Subject'</span>];</div><div class="line">        msg = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'Sns'</span>][<span class="string">'Message'</span>];</div><div class="line"></div><div class="line">    slack.chat.post_message(ch, msg)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    event= &#123;&#125;;</div><div class="line">    event[<span class="string">"channel"</span>] = <span class="string">"#general"</span>;</div><div class="line">    event[<span class="string">"message"</span>] = <span class="string">"메인 테스트"</span>;</div><div class="line">    </div><div class="line">    handler(event, <span class="keyword">None</span>);</div></pre></td></tr></table></figure>
<h3 id="4-대기정보-Lambda에서-SNS로-메세지-보내기"><a href="#4-대기정보-Lambda에서-SNS로-메세지-보내기" class="headerlink" title="4. 대기정보 Lambda에서 SNS로 메세지 보내기"></a>4. 대기정보 Lambda에서 SNS로 메세지 보내기</h3><p>2번 항목에서 만든 코드에 SNS를 통해서 메세지를 전달하는 코드를 추가해 보자.<br>먼저 AWS 서비스를 이용하기 위해 <code>boto</code>를 설치하자.</p>
<blockquote>
<p>pip install boto -t .</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> BeautifulSoup <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> boto.sns</div><div class="line"></div><div class="line">URL = <span class="string">'http://cleanair.seoul.go.kr/air_city.htm?method=measure'</span></div><div class="line"></div><div class="line">REGION = <span class="string">'&#123;리전&#125;'</span></div><div class="line">TOPIC  = <span class="string">'&#123;SNS ARN 주소&#125;'</span></div><div class="line"></div><div class="line">conn = boto.sns.connect_to_region( REGION )</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetInfo</span><span class="params">(gu)</span>:</span></div><div class="line">    response = requests.get(URL)</div><div class="line">    html_doc = response.text</div><div class="line">    soup = BeautifulSoup(html_doc)</div><div class="line"></div><div class="line">    tables = soup.findAll(<span class="string">'table'</span>);</div><div class="line">    dataTable = tables[<span class="number">2</span>]</div><div class="line">    trs = dataTable.findAll(<span class="string">'tr'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> tr <span class="keyword">in</span> trs:</div><div class="line">        <span class="keyword">if</span> gu <span class="keyword">in</span> str(tr):</div><div class="line">            <span class="keyword">return</span> tr;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">MakeMessage</span><span class="params">(data)</span>:</span></div><div class="line">    tds = data.findAll(<span class="string">'td'</span>)</div><div class="line"></div><div class="line">    message1 = <span class="string">u'종로구의 현재 통합대기환경지수는 &#123;&#125;(&#123;&#125;) 입니다.'</span>.format(tds[<span class="number">7</span>].getText(), tds[<span class="number">8</span>].getText())</div><div class="line">    message2 = <span class="string">u'미세먼지: &#123;&#125;㎍/㎥, 초미세먼지: &#123;&#125;㎍/㎥, 오존: &#123;&#125;ppm, 이산화질소: &#123;&#125;ppm, 일산화탄소: &#123;&#125;ppm, 아황산가스: &#123;&#125;ppm'</span>.format(tds[<span class="number">1</span>].getText(), tds[<span class="number">2</span>].getText(), tds[<span class="number">3</span>].getText(), tds[<span class="number">4</span>].getText(), tds[<span class="number">5</span>].getText(), tds[<span class="number">6</span>].getText())</div><div class="line"></div><div class="line">    messageTotal = message1 + <span class="string">u"("</span> + message2 + <span class="string">")"</span></div><div class="line">    <span class="keyword">return</span> messageTotal</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></div><div class="line">    msg = MakeMessage(GetInfo(<span class="string">'종로구'</span>))</div><div class="line"></div><div class="line">    pub = conn.publish( topic = TOPIC, subject =<span class="string">"#general"</span>  ,message = msg )</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    handler(<span class="keyword">None</span>, <span class="keyword">None</span>)</div></pre></td></tr></table></figure>
<p>Lambda로 올리기 전에 테스트로 실행해 본 후 정상적으로 실행되는지 확인해 보자.  </p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Chatbot.04.png?raw=true"></p>
<p>위 코드 실행 후 Slcak을 통해서 메세지가 전달되었다면 성공한 것이다.<br>위 코드도 폴더 전체를 압축해서 Lambda로 배포하자. </p>
<h2 id="5-CloudWatch를-통해서-event-생성하기"><a href="#5-CloudWatch를-통해서-event-생성하기" class="headerlink" title="5. CloudWatch를 통해서 event 생성하기"></a>5. CloudWatch를 통해서 event 생성하기</h2><p>CloudWatch의 event를 통해서 특정 시점에 Lambda 를 실행시킬 수 있다.</p>
<ul>
<li><code>CloudWatch</code> -&gt; <code>Events</code> -&gt; <code>Create rule</code><ul>
<li><code>Add taget</code>을 눌러서 위에 배포한 Lambda를 선택 : 별도로 인자로 받는게 없으므로 나머지 설정들은 기본 그대로 둠</li>
<li><code>Event Source</code>를 <code>Schedule</code>로 선택<ul>
<li><code>Cron Expression</code> : <code>20 3,20 * * ? *</code>로 입력 (UTC 기준 매일 3시 20분, 20시 20분에 실행을 시킨다는 뜻)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>저장을 하면 끝이다.</p>
<p>이제 설정한 시간에 Lambda가 실행되어서 Slack에 메세지를 전달해 줄 것이다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Chatbot.05.png?raw=true"></p>
<p>하루가 지난 시점에 확인해보니 설정한 시간에 꼬박꼬박 실행 중이다.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/03/26/Lambda.Chatbot.01/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2017/03/26/Lambda.Chatbot.01/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/19/Lambda.invoke.Lambda/">
                            Lambda에서 Lambda를 호출하는 방법
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-19T00:00:00+09:00">
	
		    Mar 19, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/AWS/">AWS</a>, <a class="category-link" href="/categories/AWS/Lambda/">Lambda</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Lambda에서-Lambda를-호출하는-방법"><a href="#Lambda에서-Lambda를-호출하는-방법" class="headerlink" title="Lambda에서 Lambda를 호출하는 방법"></a>Lambda에서 Lambda를 호출하는 방법</h1><p>AWS Lambda에서 Lambda를 호출하는 방법들에 대해서 소개하겠다.</p>
<h2 id="언제-Lambda에서-Lambda를-호출하면-편리할까"><a href="#언제-Lambda에서-Lambda를-호출하면-편리할까" class="headerlink" title="언제 Lambda에서 Lambda를 호출하면 편리할까 ?"></a>언제 Lambda에서 Lambda를 호출하면 편리할까 ?</h2><p>첫째, 배치 성격의 작업을 여러 개로 나누어 병렬로 실행할 경우를 생각할 수 있다.<br>Lambda 내에서 배치작업을 모두 다 실행시키도록 작성 할 수도 있겠지만,<br>첫번째 Lambda에서 작업 전 필요한 준비작업을 한 후 이것을 다른 Lambda로 전달 할 수 있다.<br>그 과정에서 다음 Lambda 1개에게 전달할게 아니라 비동기 invoke로 한 번에 여러 개의 Lambda를 생성하여 작업하면 전체 실행 시간을 줄일수 있을 것이다.<br>(하지만 동시에 여러 Lambda가 실행될 경우 계정당 Lambda Limit 내에서 실행되도록 조정은 해야 한다.)</p>
<p>이 경우 <a href="https://aws.amazon.com/step-functions" target="_blank" rel="external">AWS Step Functions</a> 를 이용할 수도 있다.<br>Step Functions를 사용하려고 살펴봤는데 아직까진 사용 사례도 없고, 그 과정에서의 비용도 있고, API Gateway와의 연동에 대해서도 확신이 없다.<br><a href="https://aws.amazon.com/ko/about-aws/whats-new/2017/02/amazon-api-gateway-integration-with-aws-step-functions" target="_blank" rel="external">API Gateway에서 Step Function 호출을 지원</a>한다는 글이 2017.02.15 에 올라오긴 했다.</p>
<p>둘째, 빠른 API 응답을 위해서 사용할 수 있다.<br>Lambda를 만들었을 때의 원래 의도는 AWS 서비스 상에서의 event성 호출들에 대한 처리를 전적으로 할 목적이었다고 한다.<br>하지만 API Gateway가 나온 이후로 Lambda를 이용하여 Serverless API를 구축하는게 가능하다.<br>API를 호출한 사용자 입장에서 생각해 본다면 필요한 데이터를 빨리 응답해 주고, 나머지 작업들은 그 뒤에 따로 처리를 하는 방법이 있으면 좋을 것이다.<br>예를 들어서 사용자가 접속시 호출해야하는 API가 있다고 가정해보자.<br>이 API에서는 사용자가 이전에 어떤 작업을 하고 있었는지를 조회해서 알려줘야하며, 현재 시점의 접속 상태(시간, 위치, 접속한 기기정보 등)를 기록해야 한다면, 먼저 사용자에게 전달해야할 정보를 조회한 뒤, 기록해야 할 정보에 대해서 다른 Lambda를 비동기 invoke 한 후 응답을 하도록 설계가 가능하다.</p>
<p>Lambda에서 Lambda 를 호출하는 방법에는 동기 invoke와 비동기 invoke 2가지가 있다.</p>
<ul>
<li>동기 invoke : Lambda 호출 후 그 응답을 기다린다. 응답 결과를 보고 뭔가 처리를 해야할 경우에 사용된다.</li>
<li>비동기 invokde : Lambda 호출 후 응답을 기다리지 않고 지나간다.</li>
</ul>
<p>동기든 비동기든 둘 다 Lambda 비용에 대해서 생각을 한다면 Lambda 를 2개 이상으로 나누는 것이 무조건 손해이다.<br>Lambda는 과금이 <em>설정 메모리 x 수행시간(100 ms 단위)</em> 이다.<br>만약 평균 수행시간 199 ms 인 작업을 2개의 Lambda로 나뉠 경우 100 ms + 99 ms로 나뉜다면 1개로 하는 것과 같은 비용이 들겠지만 101ms + 98ms 로 나뉜다면 100ms 수행시간에 대한 비용을 더 지불해야 한다. 이건 비동기 호출의 경우이고, 동기 호출이라면 첫번째 Lambda가 2번째 Lambda를 기다려야 하므로 최선의 경우라도 300 ms 만큼의 요금이 부과될 것이다. 더군다나 2번째로 호출되는 Lambda가 cold start 될 경우 첫번째 Lambda가 그 응답을 기다려야 하므로 비용은 훨씬 더 늘 것이다.<br>이점을 충분히 고려해서 해당 비용을 감안하더라도 Lambda를 나누는것이 유리하다고 판단이 되는 작업을 나누길 바란다.</p>
<p>이제부터 Lambda에서 Lambda를 호출하는 방법들에 대해서 하나 하나씩 살펴보도록 하자.</p>
<p>예제는 <strong>Node.JS</strong>로 작업하겠다.<br>AWS내의 event를 <strong>JSON Object</strong>로 전달하므로 Node.JS로 작업하는게 가장 편하다.<br>다른 언어로 하려면 event 모양별로 model을 미리 선언해 주거나 stream을 이용해서 해당 언어별 JSON을 지원해주는 라이브러리로 전달하는 방법을 사용하여야 한다. 응답해야할 결과가 있고, 그것이 JSON Object일 경우에는 응답에도 똑같은 처리를 해줘야 한다. Python의 경우는 그나마 JSON 친화적(?) 이어서 Node.JS 다음으로 편한 것 같다.</p>
<h2 id="Lambda에서-Lambda를-호출하는-방법-1"><a href="#Lambda에서-Lambda를-호출하는-방법-1" class="headerlink" title="Lambda에서 Lambda를 호출하는 방법"></a>Lambda에서 Lambda를 호출하는 방법</h2><h3 id="1-Lambda를-직접-invoke"><a href="#1-Lambda를-직접-invoke" class="headerlink" title="1. Lambda를 직접 invoke"></a>1. Lambda를 직접 invoke</h3><p>유일하게 Lambda 간의 동기 invoke가 가능한 방법이다.<br>가장 쉬운 방법이기도 하다.</p>
<p>먼저 호출 될 Lambda를 먼저 등록하자.<br>Lambda 등록에 대한 설명은 생략하겠다.<br>이전에 포스팅한 글을 참조하길 바란다.</p>
<blockquote>
<p><a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda%2BAPIGateWay.01.md" target="_blank" rel="external">AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기</a></p>
</blockquote>
<h4 id="1-1-호출될-Lambda-등록"><a href="#1-1-호출될-Lambda-등록" class="headerlink" title="1.1 호출될 Lambda 등록"></a>1.1 호출될 Lambda 등록</h4><p>아래 코드로 <code>echoTest</code>란 이름으로 Lambda를 등록한다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line"></div><div class="line">exports.handler = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.info(util.inspect(event, &#123;<span class="attr">depth</span>:<span class="literal">null</span>&#125;));</div><div class="line">  callback(<span class="literal">null</span>, event);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>등록 후 오른쪽 위를 보면 <code>ARN (Amazon Resource Name)</code>을 볼 수 있다.</p>
<blockquote>
<p><code>ARN</code> - arn:aws:lambda:{region}:{id}:function:echoTest</p>
</blockquote>
<p>이걸 이용해서 <code>aws-sdk</code>를 사용해서 Lambda를 호출할 것이다.</p>
<h4 id="1-2-동기-호출-코드"><a href="#1-2-동기-호출-코드" class="headerlink" title="1.2 동기 호출 코드"></a>1.2 동기 호출 코드</h4><p>이제 호출 할 Lambda를 작성해보록 하자.</p>
<p>먼저 local에서 테스트해보기 위해서는 <code>aws-sdk</code>를 설치해야 한다.<br>Lambda 상에는 설치가 되어 있으므로 같이 올릴 필요가 없다.</p>
<blockquote>
<p>npm install aws-sdk –save</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> aws = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"><span class="keyword">const</span> lambda = <span class="keyword">new</span> aws.Lambda(&#123;</div><div class="line">  <span class="attr">region</span>: <span class="string">'ap-northeast-1'</span> <span class="comment">//change to your region</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> event = &#123; <span class="attr">id</span>: <span class="string">"1"</span>, <span class="attr">name</span>:<span class="string">"Luna"</span>&#125;;</div><div class="line">lambda.invoke(&#123;</div><div class="line">  <span class="attr">FunctionName</span>: <span class="string">'echoTest'</span>,</div><div class="line">  <span class="attr">Payload</span>: <span class="built_in">JSON</span>.stringify(event, <span class="literal">null</span>, <span class="number">2</span>) <span class="comment">// pass params</span></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (error) &#123;</div><div class="line">    <span class="built_in">console</span>.info(error);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.info(data);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>만약 위 코드를 <code>index.js</code>로 저장했다면 아래와 같이 실행하면 결과를 확인할 수 있다.</p>
<blockquote>
<p>node index.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">StatusCode</span>: <span class="number">200</span>, <span class="attr">Payload</span>: <span class="string">'&#123;"id":"1","name":"Luna"&#125;'</span> &#125;</div></pre></td></tr></table></figure>
<h4 id="1-3-비동기-호출-코드"><a href="#1-3-비동기-호출-코드" class="headerlink" title="1.3 비동기 호출 코드"></a>1.3 비동기 호출 코드</h4><p>위 코드는 동기 invoke 하였다.<br>비동기로 하기 위해서는 예전에는 <code>InvokeAsync()</code> 함수를 사용했는데 이 방법은 <em>deprecated</em> 되었다.<br>지금은 <code>InvocationType</code>이란 인자에 <code>Event</code>값을 추가해주면 된다.<br>참고로 default인 동기 호출의 설정값은 <code>InvocationType: &#39;RequestResponse&#39;</code>이다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> aws = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"><span class="keyword">const</span> lambda = <span class="keyword">new</span> aws.Lambda(&#123;</div><div class="line">  <span class="attr">region</span>: <span class="string">'ap-northeast-1'</span> <span class="comment">//change to your region</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> event = &#123; <span class="attr">id</span>: <span class="string">"1"</span>, <span class="attr">name</span>:<span class="string">"Luna"</span>&#125;;</div><div class="line">lambda.invoke(&#123;</div><div class="line">  <span class="attr">FunctionName</span>: <span class="string">'echoTest'</span>,</div><div class="line">  <span class="attr">InvocationType</span>: <span class="string">'Event'</span>,</div><div class="line">  <span class="attr">Payload</span>: <span class="built_in">JSON</span>.stringify(event, <span class="literal">null</span>, <span class="number">2</span>) <span class="comment">// pass params</span></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (error) &#123;</div><div class="line">    <span class="built_in">console</span>.info(error);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.info(data);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>위와 같이 코드를 수정 후 호출하면 응답코드가 다르게 전달되는걸 확인할 수 있다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">StatusCode</span>: <span class="number">202</span>, <span class="attr">Payload</span>: <span class="string">''</span> &#125;</div></pre></td></tr></table></figure>
<p>앞의 동기 invoke의 경우 <code>200(성공)</code>으로 서버가 요청을 정상적으로 처리했다는 코드를 보내왔지만,<br>아래 비동기 invoke의 경우 <code>202(허용됨)</code>으로 서버가 요청을 접수했지만 아직 처리하지 않았다는 응답을 보내왔다.</p>
<p>Lambda 상에서 제대로 처리된지 볼려면 echoTest에 <code>console.info</code>로 출력한 내용을 보면 된다.</p>
<p>&gt;</p>
<ul>
<li>11:52:05<br>START RequestId: 094d4d3e-0c4f-11e7-ab68-a96f2d3f979f Version: $LATEST  </li>
<li>11:52:05<br>2017-03-19T02:52:05.890Z    094d4d3e-0c4f-11e7-ab68-a96f2d3f979f    { id: ‘1’, name: ‘Luna’ }  </li>
<li>11:52:05<br>END RequestId: 094d4d3e-0c4f-11e7-ab68-a96f2d3f979f  </li>
<li>11:52:05<br>REPORT RequestId: 094d4d3e-0c4f-11e7-ab68-a96f2d3f979f    Duration: 208.59 ms    Billed Duration: 300 ms Memory Size: 128 MB    Max Memory Used: 15 MB  </li>
<li>11:58:09<br>START RequestId: e23bf84a-0c4f-11e7-81f6-25e9632564aa Version: $LATEST  </li>
<li>11:58:09<br>2017-03-19T02:58:09.644Z    e23bf84a-0c4f-11e7-81f6-25e9632564aa    { id: ‘1’, name: ‘Luna’ }  </li>
<li>11:58:09<br>END RequestId: e23bf84a-0c4f-11e7-81f6-25e9632564aa  </li>
<li>11:58:09<br>REPORT RequestId: e23bf84a-0c4f-11e7-81f6-25e9632564aa    Duration: 23.59 ms    Billed Duration: 100 ms Memory Size: 128 MB    Max</li>
</ul>
<p>위 11:52에 수행된게 동기로 호출한 결과이며 아래 11:58에 수행된게 비동기로 호출한 결과이다. 둘 다 똑같이 <code>console.info</code>로 출력한 결과가 있는걸로 봐서 정상적으로 수행되었다고 판단할 수 있다. 수행시간이 다른건 앞에껀 cold start가 되었고, 뒤에껀 warm start가 된 결과로 보인다.</p>
<p>위 테스트 코드를 Lambda로 올리는 과정은 생략하겠다.<br>수행할 코드들을 <code>exports.handler = (event, context, callback) =&gt; { }</code>로 감싸서 올리면 된다.</p>
<h3 id="2-SNS의-Subscription으로-Lambda를-등록"><a href="#2-SNS의-Subscription으로-Lambda를-등록" class="headerlink" title="2. SNS의 Subscription으로 Lambda를 등록"></a>2. SNS의 Subscription으로 Lambda를 등록</h3><p><a href="https://aws.amazon.com/sns" target="_blank" rel="external">AWS SNS (Simple Notification Service)</a>는 간단한 푸시 알림 서비스이다.<br>SNS를 하나 만들어서 실행할 Lambda를 구독자로 등록해 놓고, 해당 SNS에 publish하는 방법으로 연동을 생각해 볼 수 있다.</p>
<h4 id="2-1-SNS-생성-및-Lambda를-subscription으로-등록"><a href="#2-1-SNS-생성-및-Lambda를-subscription으로-등록" class="headerlink" title="2.1 SNS 생성 및 Lambda를 subscription으로 등록"></a>2.1 SNS 생성 및 Lambda를 subscription으로 등록</h4><p>먼저 SNS를 생성한다.</p>
<ol>
<li>SNS dashboard에서 <code>Create topic</code>을 누름 (Topics에서 <code>Create new topic</code>를 눌러도 됨)</li>
<li>Topic 생성<ul>
<li>Topic name : testSns</li>
<li>Display name : testSns</li>
</ul>
</li>
</ol>
<p><code>Actions</code>를 눌러서 <code>Edit topic policy</code>나 <code>Edit topic delivery policy</code>를 눌러서 각종 설정이 가능하다.<br>여기에서는 그 내용에 대해서는 다루지 않겠다.<br>별로 어렵지 않으니 필요할 경우 직접 해보길 바란다.</p>
<p>이제 해당 SNS에 Lambda를 등록할건데,<br>앞에서 작성한 <code>testEcho</code>를 등록하도록 하자.</p>
<ol>
<li>생성된 SNS의 ARN링크  <code>arn:aws:sns:{region}:{id}:testSns</code>를 눌러서 <code>Topic details</code>로 들어감</li>
<li><code>Create subscription</code>을 누름<ul>
<li>Protocol : <code>AWS Lambda</code>를 선택</li>
<li>Endpoint : 실행할 Lambda의 ARN을 선택</li>
<li>Version or alias : 일단 default 그대로 둠 (실제 서비스 할 경우에는 alias로 설정을 해야 편함)</li>
</ul>
</li>
</ol>
<p>Version을 <strong>$LASTEST</strong>로 설정을 하면 관련 권한이 없다고 오류가 발생한다.<br>일단은 그냥 넘어가자.<br>실제 서비스 하는 경우라도 <strong>$LASTEST</strong>는 상당히 위험한 방법이다.<br>Lambda 배포 후 테스트 과정을 거쳐서 검증되기 전까지는 <code>alias</code>를 사용해서 믿을만한 버전으로 서비스하는게 좋다.</p>
<h4 id="2-2-SNS에서-Lambda-호출-테스트"><a href="#2-2-SNS에서-Lambda-호출-테스트" class="headerlink" title="2.2 SNS에서 Lambda 호출 테스트"></a>2.2 SNS에서 Lambda 호출 테스트</h4><p>SNS 콘솔에서 Lambda를 제대로 호출하는지 테스트 해보자.</p>
<ul>
<li><code>Topic details</code> 화면에서 <code>Publish to topic</code>를 누름<ul>
<li>Subject : <code>test subject</code></li>
<li>Message format : <code>JSON</code></li>
<li><code>JSON message generator</code>를 눌러서 Message에 입력 : <code>지켜보고 있다.</code></li>
<li><code>Generate JSON</code> 을 누름</li>
<li><code>Publish message</code> 누름</li>
</ul>
</li>
</ul>
<p>이제 Lambda 의 CloudFront로 가서 제대로 호출되었는지 살펴보자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">Records</span>: </div><div class="line">[ &#123; <span class="attr">EventSource</span>: <span class="string">'aws:sns'</span>,</div><div class="line"><span class="attr">EventVersion</span>: <span class="string">'1.0'</span>,</div><div class="line"><span class="attr">EventSubscriptionArn</span>: <span class="string">'arn:aws:sns&#123;region&#125;:&#123;id&#125;:testSns:1009056c-eb87-4f68-9cb1-de50b0024b90'</span>,</div><div class="line"><span class="attr">Sns</span>: </div><div class="line">&#123; <span class="attr">Type</span>: <span class="string">'Notification'</span>,</div><div class="line"><span class="attr">MessageId</span>: <span class="string">'d0e91f46-c46c-5ead-9633-4e013fb6c04d'</span>,</div><div class="line"><span class="attr">TopicArn</span>: <span class="string">'arn:aws:sns&#123;region&#125;:&#123;id&#125;:testSns'</span>,</div><div class="line"><span class="attr">Subject</span>: <span class="string">'test subject'</span>,</div><div class="line"><span class="attr">Message</span>: <span class="string">'지켜보고 있다.'</span>,</div><div class="line"><span class="attr">Timestamp</span>: <span class="string">'2017-03-19T03:23:06.272Z'</span>,</div><div class="line"><span class="attr">SignatureVersion</span>: <span class="string">'1'</span>,</div><div class="line"><span class="attr">Signature</span>: <span class="string">'...'</span>,</div><div class="line"><span class="attr">SigningCertUrl</span>:  <span class="string">'https://...'</span>,</div><div class="line"><span class="attr">UnsubscribeUrl</span>: <span class="string">'https://...'</span>,</div><div class="line"><span class="attr">MessageAttributes</span>: &#123;&#125; &#125; &#125; ] &#125;</div></pre></td></tr></table></figure>
<p>위의 결과가 출력된걸로 봐서 제대로 호출되었다고 판단이 가능하다.</p>
<h4 id="2-3-코드에서-SNS를-호출하기"><a href="#2-3-코드에서-SNS를-호출하기" class="headerlink" title="2.3 코드에서 SNS를 호출하기"></a>2.3 코드에서 SNS를 호출하기</h4><p>아래와 같이 코드를 작성하자.<br>그냥 <code>sns.js</code>로 저장하도록 하겠다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"></div><div class="line">AWS.config.update(&#123;</div><div class="line">  <span class="attr">accessKeyId</span>: <span class="string">"..."</span>,</div><div class="line">  <span class="attr">secretAccessKey</span>: <span class="string">"..."</span>,</div><div class="line">  <span class="attr">region</span>: <span class="string">'...'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> sns = <span class="keyword">new</span> AWS.SNS();</div><div class="line"><span class="keyword">const</span> params = &#123;</div><div class="line">  <span class="attr">TargetArn</span>:<span class="string">'arn:aws:&#123;region&#125;:&#123;id&#125;:testSns'</span>,</div><div class="line">  <span class="attr">Message</span>:<span class="string">'&#123;"id":"snsFromNodeJS", "name":"Luna"&#125;&#125;'</span>,</div><div class="line">  <span class="attr">Subject</span>: <span class="string">'TestSNS'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">sns.publish(params, <span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Error sending a message'</span>, err);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Sent message:'</span>, data.MessageId);</div><div class="line">    <span class="built_in">console</span>.info(data);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>실행하면 다음과 같은 응답을 얻을 수 있다.</p>
<blockquote>
<p>node sns.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">ResponseMetadata</span>: &#123; <span class="attr">RequestId</span>: <span class="string">'64efe66a-abfa-5a12-8abd-b72d55ebe4ce'</span> &#125;,</div><div class="line">  <span class="attr">MessageId</span>: <span class="string">'207e6adf-277a-5191-a94b-3b98d96b3f4d'</span> &#125;</div></pre></td></tr></table></figure>
<p>Lambda 의 CloudFront로 가서 제대로 호출되었는지 살펴보자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[ &#123; <span class="attr">EventSource</span>: <span class="string">'aws:sns'</span>,</div><div class="line"><span class="attr">EventVersion</span>: <span class="string">'1.0'</span>,</div><div class="line"><span class="attr">EventSubscriptionArn</span>: <span class="string">'arn:aws:sns:&#123;region&#125;:&#123;id&#125;:testSns:1009056c-eb87-4f68-9cb1-de50b0024b90'</span>,</div><div class="line"><span class="attr">Sns</span>: </div><div class="line">&#123; <span class="attr">Type</span>: <span class="string">'Notification'</span>,</div><div class="line"><span class="attr">MessageId</span>: <span class="string">'207e6adf-277a-5191-a94b-3b98d96b3f4d'</span>,</div><div class="line"><span class="attr">TopicArn</span>: <span class="string">'arn:aws:sns:&#123;region&#125;:&#123;id&#125;:testSns'</span>,</div><div class="line"><span class="attr">Subject</span>: <span class="string">'TestSNS'</span>,</div><div class="line"><span class="attr">Message</span>: <span class="string">'&#123;"id":"snsFromNodeJS", "name":"Luna"&#125;&#125;'</span>,</div><div class="line"><span class="attr">Timestamp</span>: <span class="string">'2017-03-19T03:32:33.996Z'</span>,</div><div class="line"><span class="attr">SignatureVersion</span>: <span class="string">'1'</span>,</div><div class="line"><span class="attr">Signature</span>: <span class="string">'...'</span>,</div><div class="line"><span class="attr">SigningCertUrl</span>: <span class="string">'https://...'</span>,</div><div class="line"><span class="attr">UnsubscribeUrl</span>: <span class="string">'https://...'</span>,</div><div class="line"><span class="attr">MessageAttributes</span>: &#123;&#125; &#125; &#125; ] &#125;</div></pre></td></tr></table></figure>
<p>위 출력문으로 봐서 제대로 호출된게 확인 된다.</p>
<h3 id="3-Kinesis로-Lambda-호출하기"><a href="#3-Kinesis로-Lambda-호출하기" class="headerlink" title="3. Kinesis로 Lambda 호출하기"></a>3. Kinesis로 Lambda 호출하기</h3><p><a href="hhttps://aws.amazon.com/kinesis/streams" target="_blank" rel="external">AWS Kinesis</a> 는 스트리밍 데이터들을 처리하기 위한 용도로 만들어 졌다.<br>입력받은 데이터들을 100개 단위(설정에서 변경 가능)로 묶어서 처리한다던지 그런 용도로 많이 사용한다.<br>Kinesis를 Lambda에서 Lambda 호출용으로 사용하는건 좀 오바스럽긴 하지만 일단 한번 해보자.</p>
<h4 id="3-1-Kinesis-Stream-생성"><a href="#3-1-Kinesis-Stream-생성" class="headerlink" title="3.1 Kinesis Stream 생성"></a>3.1 Kinesis Stream 생성</h4><ul>
<li>Kinesis Streams 콘솔로 들어가서 <code>Create stream</code>를 누름<ul>
<li>Stream name : <code>testKinesis</code> 입력</li>
<li>Number of shards : <code>1</code>입력</li>
<li><code>Create stream</code>을 누름 (나머지 설정은 그냥 건드리지 않음)</li>
</ul>
</li>
</ul>
<p>Kinesis Stream이 만들어지고 난 다음 Details 탭으로 들어가서 ARN을 확인한다.</p>
<blockquote>
<p>arn:aws:kinesis:{region}:{id}:stream/testKinesis</p>
</blockquote>
<h4 id="3-2-Lambda에서-trggier로-Kinesis-등록하기"><a href="#3-2-Lambda에서-trggier로-Kinesis-등록하기" class="headerlink" title="3.2 Lambda에서 trggier로 Kinesis 등록하기"></a>3.2 Lambda에서 trggier로 Kinesis 등록하기</h4><p>먼저 Lambda의 Role에 Kinesis 관련 권한이 있는지 확인하고 없으면 추가해 준다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;kinesis:GetRecords&quot;,</div><div class="line">&quot;kinesis:GetShardIterator&quot;,</div><div class="line">&quot;kinesis:DescribeStream&quot;,</div><div class="line">&quot;kinesis:ListStreams&quot;</div></pre></td></tr></table></figure>
<p>위에 나열한 권한이 필요하다.</p>
<ol>
<li><code>echoTest</code> Lambda 설정으로 이동</li>
<li><code>Add trigger</code>를 누름<ul>
<li><code>Kinesis</code> 선택<ul>
<li>Kinesis stream : <code>testKinesis</code> 선택</li>
<li>Batch size : <code>1</code> 입력</li>
<li>Start position : <code>Trim horizon</code>을 선택</li>
<li><code>Submit</code> 누름</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="3-3-코드에서-Kinesis-호출하기"><a href="#3-3-코드에서-Kinesis-호출하기" class="headerlink" title="3.3 코드에서 Kinesis 호출하기"></a>3.3 코드에서 Kinesis 호출하기</h4><p>아래와 같이 코드를 작성하자.<br>그냥 <code>kinesis.js</code>로 저장하도록 하겠다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">'aws-sdk'</span>);</div><div class="line"></div><div class="line">AWS.config.update(&#123;</div><div class="line">  <span class="attr">accessKeyId</span>: <span class="string">"..."</span>,</div><div class="line">  <span class="attr">secretAccessKey</span>: <span class="string">"..."</span>,</div><div class="line">  <span class="attr">region</span>: <span class="string">'...'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">const</span> kinesis = <span class="keyword">new</span> AWS.Kinesis();</div><div class="line"></div><div class="line"><span class="keyword">const</span> KinesisData = &#123;</div><div class="line">  <span class="attr">event_name</span>: <span class="string">"Kinesis 예제"</span>,</div><div class="line">  <span class="attr">event_created_at</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">const</span> params = &#123;</div><div class="line">  <span class="attr">Data</span>: <span class="built_in">JSON</span>.stringify(KinesisData),</div><div class="line">  <span class="attr">PartitionKey</span>: <span class="string">'partition'</span>,</div><div class="line">  <span class="attr">StreamName</span>: <span class="string">'testKinesis'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">kinesis.putRecord(params, <span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Error sending a message'</span>, err);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.info(data);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>이제 실행해보자.</p>
<blockquote>
<p>node kinesis.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">ShardId</span>: <span class="string">'shardId-000000000000'</span>,</div><div class="line">  <span class="attr">SequenceNumber</span>: <span class="string">'49571470617410410658004564491315382019801680888626937858'</span> &#125;</div></pre></td></tr></table></figure>
<p>Lambda쪽 실행 결과를 살펴보자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">Records</span>: </div><div class="line">[ &#123; <span class="attr">kinesis</span>: </div><div class="line">&#123; <span class="attr">kinesisSchemaVersion</span>: <span class="string">'1.0'</span>,</div><div class="line"><span class="attr">partitionKey</span>: <span class="string">'partition'</span>,</div><div class="line"><span class="attr">sequenceNumber</span>: <span class="string">'49571470617410410658004564491315382019801680888626937858'</span>,</div><div class="line"><span class="attr">data</span>: <span class="string">'eyJldmVudF9uYW1lIjoiS2luZXNpcyDsmIjsoJwiLCJldmVudF9jcmVhdGVkX2F0IjoiMjAxNy0wMy0xOVQwNDo0ODo0My4xOTlaIn0='</span>,</div><div class="line"><span class="attr">approximateArrivalTimestamp</span>: <span class="number">1489898923.642</span> &#125;,</div><div class="line"><span class="attr">eventSource</span>: <span class="string">'aws:kinesis'</span>,</div><div class="line"><span class="attr">eventVersion</span>: <span class="string">'1.0'</span>,</div><div class="line"><span class="attr">eventID</span>: <span class="string">'shardId-000000000000:49571470617410410658004564491315382019801680888626937858'</span>,</div><div class="line"><span class="attr">eventName</span>: <span class="string">'aws:kinesis:record'</span>,</div><div class="line"><span class="attr">invokeIdentityArn</span>: <span class="string">'arn:aws:iam::768556645518:role/lambda2'</span>,</div><div class="line"><span class="attr">awsRegion</span>: <span class="string">'ap-northeast-1'</span>,</div><div class="line"><span class="attr">eventSourceARN</span>: <span class="string">'arn:aws:kinesis:ap-northeast-1:768556645518:stream/testKinesis'</span> &#125; ] &#125;</div></pre></td></tr></table></figure>
<p>살펴보니 data의 값이 누가봐도 암호화 된 것으로 보인다.</p>
<blockquote>
<p>eyJldmVudF9uYW1lIjoiS2luZXNpcyDsmIjsoJwiLCJldmVudF9jcmVhdGVkX2F0IjoiMjAxNy0wMy0xOVQwNDo0ODo0My4xOTlaIn0=</p>
</blockquote>
<p><a href="http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecord.html" target="_blank" rel="external">Amazon Kinesis Streams Service API Reference</a> 를 보면 <code>base64</code>로 암호화 되었다고 나온다.</p>
<h4 id="3-4-Lambda-코드에서-Kinesis-Data-복호화"><a href="#3-4-Lambda-코드에서-Kinesis-Data-복호화" class="headerlink" title="3.4 Lambda 코드에서 Kinesis Data 복호화"></a>3.4 Lambda 코드에서 Kinesis Data 복호화</h4><p><code>echoTest</code> Lambda 코드를 아래와 같이 수정한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">const util = require(&apos;util&apos;);</div><div class="line"></div><div class="line">exports.handler = (event, context, callback) =&gt; &#123;</div><div class="line">  const records = event.Records;</div><div class="line">  console.log(&quot;records =&quot;, records);</div><div class="line">  </div><div class="line">  records.forEach(r =&gt; &#123;</div><div class="line">    const data = new Buffer(r.kinesis.data, &apos;base64&apos;).toString(&apos;utf-8&apos;);</div><div class="line">    console.info(data);</div><div class="line">  &#125;);</div><div class="line">  </div><div class="line">  callback(null, event);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>다시 Kinesis 호출하는 코드를 실행해 보자.</p>
<blockquote>
<p>node kinesis.js</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">ShardId</span>: <span class="string">'shardId-000000000000'</span>,</div><div class="line">  <span class="attr">SequenceNumber</span>: <span class="string">'49571470617410410658004564491322635574719439376016736258'</span> &#125;</div></pre></td></tr></table></figure>
<p>Lambda쪽 실행 결과를 살펴보자.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"event_name"</span>: <span class="string">"Kinesis 예제"</span>,</div><div class="line">    <span class="string">"event_created_at"</span>: <span class="string">"2017-03-19T05:05:52.273Z"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>데이터가 잘 전달된 것을 확인할 수 있다.</p>
<p>Kinesis에서 받은 event를 보면 <strong>Records</strong>란 Key에 대해서 배열로 생성되어 있다.<br>Kinesis에서 Data들을 설정된 값 단위로 배열을 전달해 준다.<br>만약 100개로 선언되었다고 해서 항상 100개 단위로 주는건 아니다.<br>그 갯수 이하라도 데이터를 전달해주니 그걸 고려해서 코드를 작성해야 한다.</p>
<h3 id="4-그-밖에-방법들"><a href="#4-그-밖에-방법들" class="headerlink" title="4. 그 밖에 방법들"></a>4. 그 밖에 방법들</h3><p>앞의 Kinesis 연동 방법을 설정하는 중 Lambda의 Triggers 탭에서 본 것처럼 AWS 상의 여러 서비스에서 Lambda 수행이 가능하다.<br>그걸 이용해서 호출하려는 Lambda에서 해당 서비스에 데이터를 전달하고 Lambda를 호출하는 방법으로의 설정이 얼마든지 가능하다.<br>하지만 단순히 Lambda to Lambda 호출을 위해서 그런 방법을 사용하는건 비효율적인듯하다.</p>
<p>대신, 원래 하려는 작업이 S3나 DynamoDB에 데이터를 쌓는게 목적이라면 거기에 데이터를 저장하고 해당 작업에 대한 Trigger로 Lambda를 수행하도록 설정하는건 괜찮을것 같다.</p>
<p>이 내용에 대해서는 따로 다루지 않겠다.<br>AWS 공식문서 상에 자습서를 참고해서 따라해보면 금방 익힐 수 있을 것이다.</p>
<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.Lambda.Tutorial.html" target="_blank" rel="external">자습서: DynamoDB 테이블에서 새 항목 처리</a></li>
</ul>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/03/19/Lambda.invoke.Lambda/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2017/03/19/Lambda.invoke.Lambda/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/11/Lambda.Tips.01/">
                            AWS Lambda 사용에 관련된 Tip
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-11T00:00:00+09:00">
	
		    Mar 11, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/AWS/">AWS</a>, <a class="category-link" href="/categories/AWS/Lambda/">Lambda</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="AWS-Lambda-사용에-관련된-Tip"><a href="#AWS-Lambda-사용에-관련된-Tip" class="headerlink" title="AWS Lambda 사용에 관련된 Tip"></a>AWS Lambda 사용에 관련된 Tip</h1><p>그동안 AWS Lambda를 사용하면서 알게된 내용들과 최근 읽은 Lambda 관련 포스팅 내용들을 정리해 보았다.</p>
<h2 id="1-Memory-Configuration"><a href="#1-Memory-Configuration" class="headerlink" title="1. Memory Configuration"></a>1. Memory Configuration</h2><p><a href="https://aws.amazon.com/lambda/pricing" target="_blank" rel="external">Lambda의 과금</a>은 <code>실행 시간 x 사용한 메모리</code>에 의해 결정된다.</p>
<p>Lambda 실행에 메모리를 얼마나 사용하지는지를 볼려면 Lambda 내의 <code>Test</code>기능을 이용하면 확인이 가능하다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Tips.01.01.png?raw=true"></p>
<p>위 그림을 보면 <strong>1024 MB</strong>로 설정되어 있으며, 실제 사용량은 <strong>29 MB</strong>란 것을 알 수 있다.</p>
<p>Lambda가 실행하는 인스턴스의 성능은 메모리 설정값에 비례해서 CPU 성능도 결정되기 때문에 메모리 사용량이 적다고 무조건 거기에 맞게 설정을 하면 당연히 그만큼 수행시간이 길어 질 수가 있다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Tips.01.02.png?raw=true"><br><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/Cloud/AWS/Lambda/images/Lambda.Tips.01.03.png?raw=true"></p>
<p>메모리를 1/10 정도로 줄이니 수행시간도 10배 정도로 더 늘어난 것을 확인할 수 있다.<br>그러므로 최소 과금으로 설정을 하기위해서 메모리를 무조건 수행가능한 최소로 설정하는 것보다는 설정값을 바꿔가면서 테스트를 해보고 결정을 하면 된다.<br>이렇게 미리 테스트를 해보면 이왕이면 같은 금액이면서 좀 더 빠르게 수행하는 방향으로 설정하는게 가능하다.</p>
<p>과금보다 빠른 서비스가 더 중요한 경우라면 메모리를 무조건 최대로 설정하는게 좋다.<br>하지만 메모리를 높인다고 해서 무조건 그만큼 더 빨리지는건 아니다. Lambda에서 동작하는 작업 성격에 따라 메모리 설정을 더 늘려도 더 이상 수행시간이 줄어들지 않거나 줄어드는 비중이 급격히 낮아지는 구간이 있으니 테스트 해본 후 적절히 설정하면 된다.</p>
<h2 id="2-Warm-Start"><a href="#2-Warm-Start" class="headerlink" title="2. Warm Start"></a>2. Warm Start</h2><p>Lambda를 실행하면 해당 코드를 컨테이너 같은데 할당하여 EC2 instance 형식으로 수행하는 것으로 알려져 있다.<br>그래서 최초 수행시 cold start(해당 자원을 할당받는 시간) 때문에 수행시간이 좀 더 걸린다.<br>위에 그림을 보더라도 첫번째 그림과 두번째 그림의 메모리 설정값이 같은데 수행시간이 다르다.</p>
<p>그걸 방지하는 방법으로 <a href="http://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/events/ScheduledEvents.html" target="_blank" rel="external">CloudWatch Schedule Event</a>를 이용해서 5분 간격으로 Lambda를 한번씩 호출해주면 늘 warm start(바로 수행이 가능한 상태)로 유지가 가능하다.<br>실제로 Lambda가 수행되면 안될 경우에 호출되었을 때를 대비해서 따로 ping 같은 요청에 대해서 아무 일도 하지 않도록 코드를 추가해 주어야 한다.</p>
<p>하지만 이것이 모든것을 해결해주는 것 같지는 않다.<br>회사에서 다른 동료분이 테스트 해본 결과를 보니 이미 warm start 가능한 Lambda가 떠있는 상태에서 호출이 많아져서 새로운 인스턴스로 Lambda를 올려야 하는 경우를 보니 cold start로 수행되는 것 같다는 결론에 도달했다.<br>아직 정확히 어떻게 동작하는지에 대해서 알려진바가 없으니 테스트를 수행하면서 응답시간이 얼마나 걸리는지를 가지고 추측할 뿐이다.</p>
<h2 id="3-Re-use-Lambda"><a href="#3-Re-use-Lambda" class="headerlink" title="3. Re-use Lambda"></a>3. Re-use Lambda</h2><p>위 항목에서 얘기했드시 Lambda가 warm start되는 경우 기존에 실행한 컨테이너를 재사용해서 수행한다.<br>이를 이용해서 Lambda 수행시간을 짧게 할 수 있도록 코드 작성이 가능하다.</p>
<p>전역 변수를 선언해 놓고 그 값으로 테스트 해보니 warm start되는 Lambda의 경우 그 값을 계속해서 가지고 있다.</p>
<p>이를 이용해서 각종 라이브러리(npm 포함)들에 대한 초기화 코드를 handler 안에서가 아니라 전역에서 수행해두면 warm start의 경우 다시 초기화 코드를 수행하지 않아도 된다. 단, 이로 인해 발생하는 사이드 이펙트가 있는 경우에는 그것에 대한 방어코드가 추가되어야 한다.</p>
<p>DB 커넥션 역시도 매번 <code>연결 -&gt; 쿼리수행 -&gt; 종료</code>를 수행하는것 보다는 전역에 커넥션 객체를 두고 연결이 안된 경우에만 연결을 수행하고 계속해서 재사용하는 것도 가능하다.<br>이 경우 재사용되는 Lambda에서는 다시 연결할 필요가 없으니 빨라진다.<br>하지만 자주 사용되지 않은 Lambda에 대해서는 DB 입장에서 비효율적이니 사용하면 안좋을 것이다.</p>
<p>그리고 필요없이 DB 커넥션이 오랫동안 유지될 수 있다는 단점도 있다.<br>예를 들어 평균 초당 100번 수행되며 평균 수행시간이 100ms인 Lambda의 경우 10개의 인스턴스가 활성화되어 있을 것이다.<br>그런데 갑자기 1초에 200개의 요청이 오고, 그 다음부터 다시 1초당 100번의 요청이 오는 경우를 생각해보자.<br>갑자기 200개의 요청이 온 것 때문에 10개의 인스턴스가 추가로 할당될 것이다. 그 다음부터는 다시 10개의 인스턴스만 있어도 수행이 되기 때문에 나머지 10개의 인스턴스에서는 15분 가량동안 사용하지 않는 DB 커넥션을 끊지 않고 계속 가지고있게 된다.</p>
<p>장점과 단점을 같이 가지고 있는 방법이므로 판단은 각자 알아서 하길 바란다. </p>
<h2 id="4-Lambda-Limit"><a href="#4-Lambda-Limit" class="headerlink" title="4. Lambda Limit"></a>4. Lambda Limit</h2><p>각 리젼별로 Lambda가 100개 동시 수행이 가능한 것으로 기본설정 되어 있다.<br>이를 넘길 경우 Lambda가 수행되지 않는다.<br>그래서 동시 수행되는 Lambda수를 제어하기 위해서 SQS를 활용하는 방법이 있다.<br>Lambda를 바로 요청하지 않고 해당 요청을 SQS로 보내고 SQS에서 동시 실행되는 Lambda 수를 고려해서 호출을 하는 방법이다.</p>
<p><a href="http://docs.aws.amazon.com/ko_kr/lambda/latest/dg/concurrent-executions.html" target="_blank" rel="external">관련 수식</a>에 따르면 아래와 같이 계산이 가능하다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Concurrent Invocations = events (or requests) per second * function duration (in secs)</div></pre></td></tr></table></figure>
<p>하지만 API Gateway + Lambda를 활용한 Web API Service와 같이 요청시간이 늘어나는 것이 안되는 경우도 있다.<br>이 경우에는 AWS에 요청하면 늘려준다.<br>이 경우 Lambda 뿐만 아니라 EC2의 Network Interface (350이 MAX)과 API Gateway (초당 1000번)의 리미트도 같이 늘려야 할수 있으니 잘 계산해서 같이 요청을 해야 한다.<br>참고로 현재 회사에서 사용중인 리미트는 Lambda 6000, Network Interface 4000, API Gateway 6000 per second 로 늘려놓은 상태이다. </p>
<h2 id="5-Devide-Batch-Task-for-Lambda"><a href="#5-Devide-Batch-Task-for-Lambda" class="headerlink" title="5. Devide Batch Task for Lambda"></a>5. Devide Batch Task for Lambda</h2><p>참고로 이 내용은 직접 겪은게 아니라 <a href="https://medium.com/@tjholowaychuk/dos-and-don-ts-of-aws-lambda-7dfcab7ad115#.xm94uvr5l" target="_blank" rel="external">Do’s and Don’ts of AWS Lambda</a>를 참고한 내용이다.</p>
<p>Lambda로 Batch 작업을 나눠서 작업해야 할 경우 해당 작업을 얼마나 잘게 나눠서 각 Lambda로 할당을 해야하는지에 대해서 고민을 해야한다.<br>대체적으로 연산이 많아서 CPU 사용량이 많은 경우는 최대한 Lambda로 잘게 나누는게 좋다.<br>반면 Lambda 자체의 연산보다는 외부 I/O 작업이 많은 경우는 Lambda 하나의 수행시간을 길게 가져가는게 좋다.</p>
<p>어찌보면 당연한 말같다.<br>CPU 연산이 많으면 최대한 병렬로 나누어서 CPU를 많이 사용하는 것이 당연히 좋을 것이다.<br>반면, DB 연결, SQS, Kinesis 등 다른 서비스 호출 등의 통신이 필요한 경우 커넥션을 맺는 오버해드가 있으니 한 번 연결을 맺고 계속해서 수행하는게 좋을 것이다.</p>
<h2 id="6-Logging-in-Lambda"><a href="#6-Logging-in-Lambda" class="headerlink" title="6. Logging in Lambda"></a>6. Logging in Lambda</h2><p>Lambda 수행 중 로그를 수집하기 위해서 외부 서비스를 사용하면 그만큼 Lambda 성능에 영향을 미치게 된다.</p>
<p>코드에서 <strong>Node.JS</strong>의 경우 <code>console.log, console.info</code>, <strong>.NET core</strong>의 경우 <code>Console.Writeline</code>로 출력을 하면 CloudWatch에서 확인이 가능하다.<br>이 방법을 이용하면 Lambda 성능에는 거의 영향을 미치지 않고 로그를 남길 수 있다.</p>
<p>하지만, CloudWatch 사용 또한 유료이기 때문에 무한정 쌓아둘수는 없다. 특정 기간 이후에 것을 S3로 보관하는 것도 가능하며, CloudWatch에 쌓인 로그를 다른 방법으로 별도 로그 시스템으로 저장을하면 원래 수행중인 Lambda 성능에는 영향을 주지 않고도 로그 수집이 가능하다.</p>
<hr>
<h3 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h3><ul>
<li>Do’s and Don’ts of AWS Lambda : <a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#58;&#104;&#x74;&#x74;&#112;&#x73;&#x3a;&#47;&#47;&#x6d;&#x65;&#100;&#x69;&#x75;&#109;&#x2e;&#99;&#x6f;&#x6d;&#47;&#64;&#116;&#x6a;&#104;&#x6f;&#108;&#x6f;&#119;&#x61;&#x79;&#x63;&#x68;&#117;&#x6b;&#47;&#100;&#111;&#115;&#x2d;&#97;&#x6e;&#x64;&#45;&#x64;&#x6f;&#110;&#45;&#116;&#115;&#x2d;&#x6f;&#102;&#x2d;&#97;&#119;&#115;&#x2d;&#108;&#x61;&#x6d;&#x62;&#x64;&#x61;&#x2d;&#x37;&#100;&#x66;&#x63;&#97;&#98;&#x37;&#97;&#100;&#49;&#x31;&#x35;&#35;&#46;&#x78;&#109;&#x39;&#52;&#117;&#118;&#x72;&#53;&#108;">&#104;&#x74;&#x74;&#112;&#x73;&#x3a;&#47;&#47;&#x6d;&#x65;&#100;&#x69;&#x75;&#109;&#x2e;&#99;&#x6f;&#x6d;&#47;&#64;&#116;&#x6a;&#104;&#x6f;&#108;&#x6f;&#119;&#x61;&#x79;&#x63;&#x68;&#117;&#x6b;&#47;&#100;&#111;&#115;&#x2d;&#97;&#x6e;&#x64;&#45;&#x64;&#x6f;&#110;&#45;&#116;&#115;&#x2d;&#x6f;&#102;&#x2d;&#97;&#119;&#115;&#x2d;&#108;&#x61;&#x6d;&#x62;&#x64;&#x61;&#x2d;&#x37;&#100;&#x66;&#x63;&#97;&#98;&#x37;&#97;&#100;&#49;&#x31;&#x35;&#35;&#46;&#x78;&#109;&#x39;&#52;&#117;&#118;&#x72;&#53;&#108;</a></li>
<li>Best practices – AWS Lambda function : <a href="https://cloudncode.blog/2017/03/02/best-practices-aws-lambda-function" target="_blank" rel="external">https://cloudncode.blog/2017/03/02/best-practices-aws-lambda-function</a></li>
</ul>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/03/11/Lambda.Tips.01/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2017/03/11/Lambda.Tips.01/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Yun Seok-joon. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Yun Seok-joon</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Seoul, South Korea
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2015/11/10/Devops.Jenkins/">
                            <h3 class="media-heading">Install Jenkins</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 10, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.01.modeling/">
                            <h3 class="media-heading">SQLP 1-1 데이터 모델링</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.02.modeling_performance/">
                            <h3 class="media-heading">SQLP 1-2 데이터 모델과 성능</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/21/02.01.sql.basic/">
                            <h3 class="media-heading">SQLP 2-1 SQL 기본</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 21, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/23/02.02.sql.adv/">
                            <h3 class="media-heading">SQLP 2-2-1 SET, Hierarchical Query, Sub-query</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.03.group/">
                            <h3 class="media-heading">SQLP 2-2-2 GROUP function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.04.window/">
                            <h3 class="media-heading">SQLP 2-2-3 Window function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.05.dcl/">
                            <h3 class="media-heading">SQLP 2-2-4 DCL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.06.plsql/">
                            <h3 class="media-heading">SQLP 2-2-5 PL/SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/27/02.07.optimizer/">
                            <h3 class="media-heading">SQLP 2-3 Optimizing SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 27, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                59 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-kbuclmtqrwfmqogitsifpjr2mdxgukkqucv5th9u0chgrdjqgqfxwhpjxejt.min.js"></script>
<!--SCRIPTS END-->


    </body>
</html>
