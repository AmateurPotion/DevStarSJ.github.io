
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Dev Star SJ">
    <title>Category: ASP.NET Core - Dev Star SJ</title>
    <meta name="author" content="Yun Seok-joon">
    
    
    
    <meta name="description" content="Sharing the common developer&apos;s try-on">
<meta property="og:type" content="blog">
<meta property="og:title" content="Dev Star SJ">
<meta property="og:url" content="http://DevStarSJ.github.io/categories/C/ASP-NET-Core/index.html">
<meta property="og:site_name" content="Dev Star SJ">
<meta property="og:description" content="Sharing the common developer&apos;s try-on">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dev Star SJ">
<meta name="twitter:description" content="Sharing the common developer&apos;s try-on">
    
    
        
    
    
        <meta property="og:image" content="http://DevStarSJ.github.io/assets/images/sjyun.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-eoqrdyagg8lofwhg4unnxmhyxznbkxgjkodxgdtletmltlwb2wgngdrld76m.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Dev Star SJ</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Yun Seok-joon</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://DevLunaSJ.github.com/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.facebook.com/seokjoon.yun.9" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/u/1/108379332089647292574" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-google-plus"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/sjyun/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:seokjoon.yun@gmail.com" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/05/11/CSharp.AspnetCore.Install.Net.Core/">
                            .NET Core Install for Ubuntu 14.04
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-05-11T00:00:00+09:00">
	
		    May 11, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C/">C#</a>, <a class="category-link" href="/categories/C/ASP-NET-Core/">ASP.NET Core</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="NET-Core-Install-for-Ubuntu-14-04"><a href="#NET-Core-Install-for-Ubuntu-14-04" class="headerlink" title=".NET Core Install for Ubuntu 14.04"></a>.NET Core Install for Ubuntu 14.04</h1><p><code>.NET Core</code>를 <strong>Ubuntu</strong>에 설치하는 과정에 대해서 소개해드리겠습니다.</p>
<p><strong>Ubuntu</strong> 설치는 필자의 경우는 <em>Microsoft Azure</em>에 설치하였습니다.<br>(참고로 <strong>Azure</strong>에 <strong>Ubuntu</strong>설치시 SSH (22)번 빼고는 모두 막혀있습니다. Portal에서 원하시는 포트를 열어야 합니다.)</p>
<h2 id="1-NET-Core-설치-후-Hello-World-출력해보기"><a href="#1-NET-Core-설치-후-Hello-World-출력해보기" class="headerlink" title="1. .NET Core 설치 후 Hello World 출력해보기"></a>1. <strong>.NET Core</strong> 설치 후 <em>Hello World</em> 출력해보기</h2><p>먼저 <code>.Net Core</code>를 컴파일하고 실행할 수 있도록 <strong>SDK</strong>를 설치하겠습니다.</p>
<p>공식문서에 설명이 잘 되어 있습니다. (<a href="https://www.microsoft.com/net/core#ubuntu" target="_blank" rel="external">https://www.microsoft.com/net/core#ubuntu</a>)<br>아래 설명대로 해서 잘 안되면 Link의 공식문서에 바뀐 점이 있는지 보시고 따라해주세요.</p>
<p>아래 명령어를 하나씩 입력해주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sudo sh -c &apos;echo &quot;deb [arch=amd64] https://apt-mo.trafficmanager.net/repos/dotnet/ trusty main&quot; &gt; /etc/apt/sources.list.d/dotnetdev.list&apos;</div><div class="line"></div><div class="line">sudo apt-key adv --keyserver apt-mo.trafficmanager.net --recv-keys 417A0893</div><div class="line"></div><div class="line">sudo apt-get update</div><div class="line"></div><div class="line">sudo apt-get install dotnet-dev-1.0.0-preview2-003121</div></pre></td></tr></table></figure>
<p>이제 <code>.Net Core SDK</code> 설치가 끝났습니다.<br>제대로 설치가 되었는지 기본 예제를 실행해 보겠습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir hwapp</div><div class="line"></div><div class="line">cd hwapp</div><div class="line"></div><div class="line">dotnet new</div><div class="line"></div><div class="line">dotnet restore</div><div class="line"></div><div class="line">dotnet run</div></pre></td></tr></table></figure>
<p>아래와 같이 출력이 나오면 제대로 설치가 된 것입니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/install.ubuntu.01.png?raw=true">  </p>
<h2 id="2-ASP-NET-Core-용-실행환경-구성"><a href="#2-ASP-NET-Core-용-실행환경-구성" class="headerlink" title="2. ASP.NET Core 용 실행환경 구성"></a>2. <strong>ASP.NET Core</strong> 용 실행환경 구성</h2><p>먼저 <strong>Web App</strong> 생성에 필요한 것들을 설치해야 합니다.</p>
<p>자세한 설명은 다음 Link에 되어 있습니다. (<a href="https://docs.asp.net/en/1.0.0-rc1/getting-started/installing-on-linux.html#installing-on-ubuntu-14-04" target="_blank" rel="external">https://docs.asp.net/en/1.0.0-rc1/getting-started/installing-on-linux.html#installing-on-ubuntu-14-04</a>)</p>
<h3 id="2-1-NET-Version-Manager-DNVM-설치"><a href="#2-1-NET-Version-Manager-DNVM-설치" class="headerlink" title="2.1 .NET Version Manager (DNVM) 설치"></a>2.1 .NET Version Manager (DNVM) 설치</h3><p>Linux 상에서 여러 버전의 .NET 실행 환경 (.NET Execution Environment) <code>DNX</code>를 관리해주는 도구입니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install unzip curl</div><div class="line"></div><div class="line">curl -sSL https://raw.githubusercontent.com/aspnet/Home/dev/dnvminstall.sh | DNX_BRANCH=dev sh &amp;&amp; source ~/.dnx/dnvm/dnvm.sh</div></pre></td></tr></table></figure>
<h3 id="2-2-NET-Execution-Environment-DNX-설치"><a href="#2-2-NET-Execution-Environment-DNX-설치" class="headerlink" title="2.2 .NET Execution Environment (DNX) 설치"></a>2.2 .NET Execution Environment (DNX) 설치</h3><p>Linux 상에서 .NET 프로젝트를 빌드하고 실행해주는 도구입니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libunwind8 gettext libssl-dev libcurl4-openssl-dev zlib1g libicu-dev uuid-dev</div><div class="line"></div><div class="line">dnvm upgrade -r coreclr</div></pre></td></tr></table></figure>
<h3 id="2-3-libuv-설치"><a href="#2-3-libuv-설치" class="headerlink" title="2.3 libuv 설치"></a>2.3 libuv 설치</h3><p><code>libuv</code>는 멀티플랫폼 비동기 IO 라이브러리 입니다.<br><code>Kestrel</code>에서 <code>libuv</code>를 사용합니다.<br><code>Kestrel</code>은 ASP.NET Core를 호스팅하기 위한 크로스-플랫폼 HTTP 서버 입니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install make automake libtool curl</div><div class="line"></div><div class="line">curl -sSL https://github.com/libuv/libuv/archive/v1.8.0.tar.gz | sudo tar zxfv - -C /usr/local/src</div><div class="line"></div><div class="line">cd /usr/local/src/libuv-1.8.0</div><div class="line"></div><div class="line">sudo sh autogen.sh</div><div class="line"></div><div class="line">sudo ./configure</div><div class="line"></div><div class="line">sudo make</div><div class="line"></div><div class="line">sudo make install</div><div class="line"></div><div class="line">sudo rm -rf /usr/local/src/libuv-1.8.0 &amp;&amp; cd ~/</div><div class="line"></div><div class="line">sudo ldconfig</div></pre></td></tr></table></figure>
<h2 id="3-ASP-NET-Core-Web-App-생성하기"><a href="#3-ASP-NET-Core-Web-App-생성하기" class="headerlink" title="3. ASP.NET Core Web App 생성하기"></a>3. <strong>ASP.NET Core</strong> Web App 생성하기</h2><p>다음 Link의 공식문서를 보고 작성하였습니다. (<a href="https://docs.asp.net/en/latest/getting-started.html" target="_blank" rel="external">https://docs.asp.net/en/latest/getting-started.html</a>)</p>
<p>좀 전에 생성한 예제 코드로 이동하겠습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd ~/hwapp</div></pre></td></tr></table></figure>
<p><code>project.json</code>의 <code>dependencies</code>란에 다음과 같이 <code>Kestrel</code>를 추가해주세요.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0-*"</span>,</div><div class="line">  <span class="attr">"buildOptions"</span>: &#123;</div><div class="line">    <span class="attr">"debugType"</span>: <span class="string">"portable"</span>,</div><div class="line">    <span class="attr">"emitEntryPoint"</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;&#125;,</div><div class="line">  <span class="attr">"frameworks"</span>: &#123;</div><div class="line">    <span class="attr">"netcoreapp1.0"</span>: &#123;</div><div class="line">      <span class="attr">"dependencies"</span>: &#123;</div><div class="line">        <span class="attr">"Microsoft.NETCore.App"</span>: &#123;</div><div class="line">          <span class="attr">"type"</span>: <span class="string">"platform"</span>,</div><div class="line">          <span class="attr">"version"</span>: <span class="string">"1.0.0"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"Microsoft.AspNetCore.Server.Kestrel"</span>: <span class="string">"1.0.0"</span></div><div class="line">      &#125;,</div><div class="line">      <span class="attr">"imports"</span>: <span class="string">"dnxcore50"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>패키지를 project에 다운로드 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dotnet restore</div></pre></td></tr></table></figure>
<p><code>Startup.cs</code>파일을 추가하려 다음의 내용으로 작성합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">using System;</div><div class="line">using Microsoft.AspNetCore.Builder;</div><div class="line">using Microsoft.AspNetCore.Hosting;</div><div class="line">using Microsoft.AspNetCore.Http;</div><div class="line"></div><div class="line">namespace aspnetcoreapp</div><div class="line">&#123;</div><div class="line">    public class Startup</div><div class="line">    &#123;</div><div class="line">        public void Configure(IApplicationBuilder app)</div><div class="line">        &#123;</div><div class="line">            app.Run(context =&gt;</div><div class="line">            &#123;</div><div class="line">                return context.Response.WriteAsync(&quot;Hello from ASP.NET Core!&quot;);</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Program.cs</code>파일을 다음과 같이 수정해주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">using System;</div><div class="line">using Microsoft.AspNetCore.Hosting;</div><div class="line"></div><div class="line">namespace aspnetcoreapp</div><div class="line">&#123;</div><div class="line">    public class Program</div><div class="line">    &#123;</div><div class="line">        public static void Main(string[] args)</div><div class="line">        &#123;</div><div class="line">            var host = new WebHostBuilder()</div><div class="line">                .UseKestrel()</div><div class="line">                .UseStartup&lt;Startup&gt;()</div><div class="line">                .Build();</div><div class="line"></div><div class="line">            host.Run();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>그런 다음 실행합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dotnet run</div></pre></td></tr></table></figure>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/install.ubuntu.02.png?raw=true"></p>
<p>위 그림과 같은 메세지가 나오면 성공한 것입니다.</p>
<p>웹브라우저로 붙어보면 아래와 같은 그림이 나옵니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/install.ubuntu.03.png?raw=true"></p>
<h2 id="4-외부에서-접속가능하게-배포하기"><a href="#4-외부에서-접속가능하게-배포하기" class="headerlink" title="4. 외부에서 접속가능하게 배포하기"></a>4. 외부에서 접속가능하게 배포하기</h2><p>다음 Link의 공식문서를 보고 따라했습니다.<br>(<a href="https://docs.asp.net/en/latest/publishing/linuxproduction.html" target="_blank" rel="external">https://docs.asp.net/en/latest/publishing/linuxproduction.html</a>)</p>
<p><code>Nginx</code>를 설치합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install nginx</div></pre></td></tr></table></figure>
<p>이제 우리가 띄운 <code>Web App</code>으로 접속하도록 <strong>Proxy</strong>를 설정합니다.</p>
<p>설정파일은 <code>/etc/nginx/sites-available/default</code> 입니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /etc/nginx/sites-available/default</div></pre></td></tr></table></figure>
<p>버전별로 내용이 조금 다룰수 있는데 눈여겨 볼 부분은 다음과 같습니다.</p>
<h3 id="4-1-외부에서-접속할-Port-설정"><a href="#4-1-외부에서-접속할-Port-설정" class="headerlink" title="4.1 외부에서 접속할 Port 설정"></a>4.1 외부에서 접속할 Port 설정</h3><p>아래 <code>80</code>부분을 원하는 Port로 설정하면 됩니다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80 default_server;</div><div class="line">    listen [::]:80 default_server ipv6only=on;</div></pre></td></tr></table></figure></p>
<h3 id="4-2-내부로-연결한-주소-설정"><a href="#4-2-내부로-연결한-주소-설정" class="headerlink" title="4.2 내부로 연결한 주소 설정"></a>4.2 내부로 연결한 주소 설정</h3><p><code>location</code>부분을 아래와 같이 설정합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">    proxy_pass http://localhost:5000;</div><div class="line">    proxy_http_version 1.1;</div><div class="line">    proxy_set_header Upgrade $http_upgrade;</div><div class="line">    proxy_set_header Connection keep-alive;</div><div class="line">    proxy_set_header Host $host;</div><div class="line">    proxy_cache_bypass $http_upgrade;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>중요한 부분만 그림으로 보면 다음과 같습니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/install.ubuntu.04.png?raw=true"></p>
<p>수정한 내용에 이상은 없는지 확인한 후 실행합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo nginx -t</div><div class="line"></div><div class="line">sudo service nginx start</div></pre></td></tr></table></figure>
<p>만약 수행 중 변경 후 반영하려면 다음과 같이 입력해야 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx -s reload</div></pre></td></tr></table></figure>
<p>이제 외부에서 Web App으로 접근이 가능합니다</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/install.ubuntu.05.png?raw=true"></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/05/11/CSharp.AspnetCore.Install.Net.Core/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2016/05/11/CSharp.AspnetCore.Install.Net.Core/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/05/11/CSharp.AspnetCore.Depoly.VS.Git/">
                            Deploying .NET Core Web App with Visual Studio and Git
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-05-11T00:00:00+09:00">
	
		    May 11, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C/">C#</a>, <a class="category-link" href="/categories/C/ASP-NET-Core/">ASP.NET Core</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h1 id="Deploying-NET-Core-Web-App-with-Visual-Studio-and-Git"><a href="#Deploying-NET-Core-Web-App-with-Visual-Studio-and-Git" class="headerlink" title="Deploying .NET Core Web App with Visual Studio and Git"></a>Deploying .NET Core Web App with Visual Studio and Git</h1><p><strong> ASP.NET Core</strong> 개발환경으로는 Windows에서 Visual Studio를 사용하는 것이 가장 편합니다.<br>이번 포스팅에서는 Windows에서 <code>ASP.NET Core Web App</code>을 작성하여 Git을 이용하여 <strong>Ubuntu</strong>에서 실행하는 것을 소개해 드리겠습니다.</p>
<h2 id="1-Github에-Repository-생성하기"><a href="#1-Github에-Repository-생성하기" class="headerlink" title="1. Github에 Repository 생성하기"></a>1. Github에 Repository 생성하기</h2><p>본인의 GitHub 계정으로 가셔서 아래와 같이 원하는 이름으로 Repository를 생성합니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/vs.git.01.png?raw=true"></p>
<h2 id="2-PC에-GitHub-Repository-Clone-하기"><a href="#2-PC에-GitHub-Repository-Clone-하기" class="headerlink" title="2. PC에 GitHub Repository Clone 하기"></a>2. PC에 GitHub Repository Clone 하기</h2><p>원하시는 폴더로 가셔서 GitHub Repository에 연결하세요.<br>(아래에서 github 주소란에는 본인의 Repository 주소로 적어주세요.)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir WebApp</div><div class="line"></div><div class="line">cd WebApp</div><div class="line"></div><div class="line">git init</div><div class="line"></div><div class="line">git remote add origin https://github.com/DevStarSJ/WebApp.git</div><div class="line"></div><div class="line">git pull origin master</div></pre></td></tr></table></figure>
<h2 id="3-Visual-Studio로-Web-App-예제-만들기"><a href="#3-Visual-Studio로-Web-App-예제-만들기" class="headerlink" title="3. Visual Studio로 Web App 예제 만들기"></a>3. Visual Studio로 Web App 예제 만들기</h2><p><code>ASP.NET Core Web Application</code>으로 프로젝트를 생성합니다.<br>위치를 좀 전에 Git Repository로 지정한 곳으로 해주세요.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/vs.git.02.png?raw=true"></p>
<p>다음 그림에서는 <code>Web Application</code>을 선택한 후에 <code>OK</code>를 눌러주세요.</p>
<p>제대로 만들어졌는지, <code>F5</code>를 눌러서 확인해봅니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/vs.git.03.png?raw=true"></p>
<h2 id="4-GitHub에-올리기"><a href="#4-GitHub에-올리기" class="headerlink" title="4. GitHub에 올리기"></a>4. GitHub에 올리기</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git add --all</div><div class="line"></div><div class="line">git commit -m &quot;Initial Commit&quot;</div><div class="line"></div><div class="line">git push origin master</div></pre></td></tr></table></figure>
<h2 id="5-Ubuntu에서-내려받기"><a href="#5-Ubuntu에서-내려받기" class="headerlink" title="5. Ubuntu에서 내려받기"></a>5. Ubuntu에서 내려받기</h2><p>아직 <code>git</code>이 설치되어 있지 않다면 아래와 같이 설치를 해주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure>
<p>이제 원하는 폴더로 가셔서 GitHub에서 내려받습니다. 위에 Windows에서 한것과 명령어가 같습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mkdir WebApp</div><div class="line"></div><div class="line">cd WebApp</div><div class="line"></div><div class="line">git init</div><div class="line"></div><div class="line">git remote add origin https://github.com/DevStarSJ/WebApp.git</div><div class="line"></div><div class="line">git pull origin master</div></pre></td></tr></table></figure>
<p>이제 WebApp 폴더로 들어가서 <code>project.json</code>의 <code>framework</code>부분을 아래와 같이 수정합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd WebApp/src/WebApp</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">"frameworks": &#123;</div><div class="line">  "netcoreapp1.0": &#123;</div><div class="line">    "dependencies": &#123;</div><div class="line">      "Microsoft.NETCore.App": &#123;</div><div class="line">        "type": "platform",</div><div class="line">        "version": "1.0.0"</div><div class="line">      &#125;,</div><div class="line">      "Microsoft.AspNetCore.Server.Kestrel": "1.0.0"</div><div class="line">    &#125;,</div><div class="line">    "imports": "dnxcore50"</div><div class="line">  &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>저장한 뒤 이제 실행합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dotnet restore</div><div class="line"></div><div class="line">dotnet build</div><div class="line"></div><div class="line">dotnet run</div></pre></td></tr></table></figure>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/image/vs.git.04.png?raw=true"></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/05/11/CSharp.AspnetCore.Depoly.VS.Git/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2016/05/11/CSharp.AspnetCore.Depoly.VS.Git/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/05/11/CSharp.AspnetCore.WebSocket/">
                            WebSockets in .NET Core
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-05-11T00:00:00+09:00">
	
		    May 11, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C/">C#</a>, <a class="category-link" href="/categories/C/ASP-NET-Core/">ASP.NET Core</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p><code>.NET Core</code> (현재는 ASP.NET 5)로 간단한 Web Socket을 구현하는 예제코드와 설명입니다.</p>
<p>작업은 <code>Visual Studio 2015</code> , <code>ASP.NET5-rc1</code> 으로 진행하였습니다.</p>
<h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><ul>
<li><code>.NET Core</code> (ASP.NET 5 Template)로 Web Application Project를 생성</li>
<li>Server : Echo Server 를 Web Socket으로 구현<ul>
<li>Client에서 전달한 Text Message를 그대로 전달</li>
</ul>
</li>
<li>Client : jQuery를 이용한 간단한 Web Socket page를 생성</li>
<li>여러 Client가 접속한 경우 접속된 모든 Client에게 echo message를 전달</li>
</ul>
<h2 id="1-Project-생성"><a href="#1-Project-생성" class="headerlink" title="1. Project 생성"></a>1. Project 생성</h2><p><code>C#</code> -&gt; <code>Web</code> -&gt; <code>ASP.NET Web Application</code> 선택 후 <code>ASP.NET 5 Templates</code> -&gt; <code>Web Appliacaion</code>으로 Project를 생성합니다.<br><code>ASP.NET 5 Templates</code>가 설치되지 않은 경우 아래 설치 버튼이 활성화되며, 설치가 짧은 순간에 끝나지는 않으니 조금 기다리셔야 합니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.01.png?raw=true">  </p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.02.png?raw=true">  </p>
<h2 id="2-Server-Web-Socket-구현"><a href="#2-Server-Web-Socket-구현" class="headerlink" title="2. Server Web Socket 구현"></a>2. Server Web Socket 구현</h2><p><code>Startup.cs</code> 파일을 열어서 <code>public void Configure()</code> 함수에 아래 Code를 추가합니다.<br>단 <code>app.UseMvc()</code>보다 위에 위치해야 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">app.UseWebSockets();</div><div class="line">app.Use(async (http, next) =&gt;</div><div class="line">&#123;</div><div class="line">    if (http.WebSockets.IsWebSocketRequest)</div><div class="line">    &#123;</div><div class="line">        var webSocket = await http.WebSockets.AcceptWebSocketAsync();</div><div class="line"></div><div class="line">        if (webSocket != null &amp;&amp; webSocket.State == WebSocketState.Open)</div><div class="line">        &#123;</div><div class="line">            // Handle the socket here</div><div class="line">            while (webSocket.State == WebSocketState.Open)</div><div class="line">            &#123;</div><div class="line">                var token = CancellationToken.None;</div><div class="line">                var buffer = new ArraySegment&lt;byte&gt;(new byte[4096]);</div><div class="line"></div><div class="line">                var received = await webSocket.ReceiveAsync(buffer, token);</div><div class="line"></div><div class="line">                switch (received.MessageType)</div><div class="line">                &#123;</div><div class="line">                    case WebSocketMessageType.Text:</div><div class="line">                        var request = Encoding.UTF8.GetString(buffer.Array, buffer.Offset, buffer.Count);</div><div class="line"></div><div class="line">                        // Handle request here</div><div class="line">                        await webSocket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">                        break;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        await next();</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>위 Code가 실행되려면 Assembly를 하나 추가해 줘야합니다.</p>
<blockquote>
<p>“Microsoft.AspNet.WebSockets.Server”: “1.0.0-rc1-final”</p>
</blockquote>
<p><code>Nuget package manager</code>를 사용하지 않더라도 오류가 발생한 Code에서 <code>Ctrl + .</code> (Quick Action)을 이용하면 자동으로 추가가 됩니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.03.png?raw=true">  </p>
<p>또 필요한 <code>namespace</code>를 <code>using</code>에 추가를 해주는 작업도 <code>Ctrl +.</code>으로 쉽게 작업이 가능합니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.04.png?raw=true">  </p>
<p>Client에서 Connection을 연결할때마다 <code>app.Use</code>안에 선언한 함수가 실행됩니다.<br>Request가 아닌 경우에는 그냥 무시 (<code>next();</code>)를 하며 <code>Request</code>인 경우에는 <code>Accept</code>수행 후 <code>Receive</code>작업을 기다리며 Pending 상태가 됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var webSocket = await http.WebSockets.AcceptWebSocketAsync();</div><div class="line"></div><div class="line">if (webSocket != null &amp;&amp; webSocket.State == WebSocketState.Open)</div><div class="line">&#123;</div><div class="line">    while (webSocket.State == WebSocketState.Open)</div><div class="line">    &#123;</div><div class="line">        var token = CancellationToken.None;</div><div class="line">        var buffer = new ArraySegment&lt;byte&gt;(new byte[4096]);</div><div class="line"></div><div class="line">        var received = await webSocket.ReceiveAsync(buffer, token);</div><div class="line"></div><div class="line">        // Processing received message</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Message가 도착하면 <code>await webSocket.ReceiveAsync()</code>의 Pending이 해제되면서 다음 Line을 수행합니다.<br>현재 예제는 Text 타입에 대해서만 그대로 Client에게 echo message를 전달하고 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">switch (received.MessageType)</div><div class="line">&#123;</div><div class="line">    case WebSocketMessageType.Text:</div><div class="line">        await webSocket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">        break;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-Client-Web-Socket-구현"><a href="#3-Client-Web-Socket-구현" class="headerlink" title="3. Client Web Socket 구현"></a>3. Client Web Socket 구현</h2><p>편의상 추가로 <code>Controller</code>를 추가하지 않고 <code>Home</code> Controller에 <code>Chat</code>이라는 <code>Action Method</code>를 추가하도록 하겠습니다.<br><code>Controllers/HomeController.cs</code>파일을 열어서 아래 Action을 추가해 주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public ActionResult Chat()</div><div class="line">&#123;</div><div class="line">    return View();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>아무런 내용없이 그냥 기본 Routing되는 View를 return합니다.</p>
<p><code>Views/Home</code> 폴더 아래에 <code>Chat.cshtml</code>파일을 추가해서 다음과 같이 입력해주세요.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@&#123;</div><div class="line">    ViewData["Title"] = "WebSocket Chat Page";</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"chatform"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"inputbox"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"message"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//code.jquery.com/jquery-1.11.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="xml"></span></div><div class="line">    $(document).ready(function()</div><div class="line">    &#123;</div><div class="line">        var username = prompt('Enter your name: ');</div><div class="line">        var uri = 'ws://localhost:9258';</div><div class="line">        var ws = new WebSocket(uri);</div><div class="line"></div><div class="line">        ws.onopen = function () &#123;</div><div class="line">            $('#message').prepend('<span class="tag">&lt;<span class="name">div</span>&gt;</span>Connected.<span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</div><div class="line">            $('#chatform').submit(function (event) &#123;</div><div class="line">                ws.send('<span class="tag">&lt;<span class="name">strong</span>&gt;</span>' + username + ' : <span class="tag">&lt;/<span class="name">strong</span>&gt;</span>' +$('#inputbox').val());</div><div class="line">                $('#inputbox').val('');</div><div class="line">                event.preventDefault();</div><div class="line">             &#125;);</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        ws.onerror = function (event) &#123;</div><div class="line">            $('#message').prepend('<span class="tag">&lt;<span class="name">div</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        ws.onmessage = function (event) &#123;</div><div class="line">            $('#message').prepend('<span class="tag">&lt;<span class="name">div</span>&gt;</span>' + event.data + '<span class="tag">&lt;/<span class="name">div</span>&gt;</span>');</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>접속주소(<code>uri</code>) 값은 Server 실행시 port 번호를 보고 수정해 주세요.</li>
</ul>
<p><code>jQuery</code>를 nuget으로 설치해도 되지만 편의상 online으로 참조하였습니다.</p>
<ul>
<li>해당 View가 열릴때 <code>WebSocket()</code>으로 접속합니다.</li>
<li>접속에 성공하면 (<code>ws.onopen</code>) <code>chatform</code>의 <code>submit</code>작업으로 <code>ws.send()</code>를 실행하도록 설정합니다.</li>
<li><code>WebSocket</code>으로 부터 message를 전달받으면 (<code>ws,onmessage</code>)를 화면에 출력합니다.</li>
</ul>
<p>최대한 군더더기 없이 간단하게 구현하였습니다.</p>
<h2 id="4-실행"><a href="#4-실행" class="headerlink" title="4. 실행"></a>4. 실행</h2><p><code>F5</code>를 눌러서 <code>Debug</code> 수행후 접속주소에 <code>/Home/Chat</code>를 붙여서 우리가 생성한 View를 열어주세요.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.06.png?raw=true">  </p>
<p>이름을 입력해서 접속을 한 후에, 채팅 메세지를 입력하면 화면에 메세지가 출력됩니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.07.png?raw=true">  </p>
<p>위 메세지는 Client에서 출력을 한 것이 아니라 Server로 부터 전달받은 메세지 입니다.<br>믿기 힘드시겠다면, 여러 Client끼리 Chat을 할 수 있도록 Server를 수정해 보도록 하겠습니다.</p>
<h2 id="5-Server를-여러-Client에게-메세지-전달하도록-수정"><a href="#5-Server를-여러-Client에게-메세지-전달하도록-수정" class="headerlink" title="5. Server를 여러 Client에게 메세지 전달하도록 수정"></a>5. Server를 여러 Client에게 메세지 전달하도록 수정</h2><p><code>Startup.cs</code> 파일의 <code>public class Startup</code>에 thread-safety한 map을 하나 선언합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ConcurrentBag&lt;WebSocket&gt; _sockets = new ConcurrentBag&lt;WebSocket&gt;();</div></pre></td></tr></table></figure>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.05.png?raw=true">  </p>
<p>다음으로는 Client에서 접속시 <code>_sockets</code>에 socket들을 저장해 놓습니다.<br><code>// Handle the socket here</code> 바로 윗 부분에 아래 Code를 추가합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_sockets.Add(webSocket);</div></pre></td></tr></table></figure>
<p>Client에게 <code>SendAsync()</code>를 하는 부분을 전체 Client에게 전송하도록 수정합니다.<br><code>// Handle request here</code> 아래에 있는 <code>await webSocket.SendAsync()</code>줄을 지우고 아래 Code를 입력해주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">foreach (var socket in _sockets)</div><div class="line">&#123;</div><div class="line">    await socket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="6-실행"><a href="#6-실행" class="headerlink" title="6. 실행"></a>6. 실행</h2><p>이제 실행하여 Browser를 2개 띄워서 Test해보면 한 쪽에서 입력해도 양쪽으로 모두 메세지가 출력되는 것을 확인 할 수 있습니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.08.png?raw=true">  </p>
<h2 id="참조-Site"><a href="#참조-Site" class="headerlink" title="참조 Site"></a>참조 Site</h2><ul>
<li>ASP.NET 5 Server Web Socket</li>
</ul>
<p><a href="&#109;&#x61;&#105;&#108;&#116;&#111;&#x3a;&#x68;&#116;&#x74;&#x70;&#x73;&#58;&#47;&#47;&#109;&#x65;&#100;&#x69;&#117;&#109;&#x2e;&#x63;&#111;&#109;&#x2f;&#x40;&#116;&#117;&#x72;&#111;&#119;&#x69;&#x63;&#122;&#x2f;&#x77;&#x65;&#98;&#x73;&#111;&#x63;&#107;&#101;&#116;&#x73;&#x2d;&#105;&#x6e;&#x2d;&#x61;&#x73;&#x70;&#45;&#x6e;&#x65;&#116;&#x2d;&#x35;&#45;&#54;&#48;&#57;&#52;&#51;&#x31;&#x39;&#97;&#x31;&#53;&#x61;&#50;&#35;&#x2e;&#114;&#112;&#102;&#116;&#55;&#54;&#x36;&#x77;&#98;">&#x68;&#116;&#x74;&#x70;&#x73;&#58;&#47;&#47;&#109;&#x65;&#100;&#x69;&#117;&#109;&#x2e;&#x63;&#111;&#109;&#x2f;&#x40;&#116;&#117;&#x72;&#111;&#119;&#x69;&#x63;&#122;&#x2f;&#x77;&#x65;&#98;&#x73;&#111;&#x63;&#107;&#101;&#116;&#x73;&#x2d;&#105;&#x6e;&#x2d;&#x61;&#x73;&#x70;&#45;&#x6e;&#x65;&#116;&#x2d;&#x35;&#45;&#54;&#48;&#57;&#52;&#51;&#x31;&#x39;&#97;&#x31;&#53;&#x61;&#50;&#35;&#x2e;&#114;&#112;&#102;&#116;&#55;&#54;&#x36;&#x77;&#98;</a></p>
<ul>
<li>Client jQuery Web Socket</li>
</ul>
<p><a href="https://blogs.msdn.microsoft.com/youssefm/2012/07/17/building-real-time-web-apps-with-asp-net-webapi-and-websockets" target="_blank" rel="external">https://blogs.msdn.microsoft.com/youssefm/2012/07/17/building-real-time-web-apps-with-asp-net-webapi-and-websockets</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/05/11/CSharp.AspnetCore.WebSocket/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2016/05/11/CSharp.AspnetCore.WebSocket/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/05/09/CSharp.AspnetCore.SignalR/">
                            Using SignalR in ASP.NET Core
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2016-05-09T00:00:00+09:00">
	
		    May 09, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C/">C#</a>, <a class="category-link" href="/categories/C/ASP-NET-Core/">ASP.NET Core</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p><code>SignalR</code>을 <code>ASP.NET 5 Template</code>에서 사용하기 위해서는 <code>Startup.cs</code>의 <code>public void Configure(IApplicationBuilder app, ...)</code>에서 아래와 같은 구문이 필요합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class Startup</div><div class="line">&#123;</div><div class="line">	public void Configure(IApplicationBuilder app)</div><div class="line">	&#123;</div><div class="line">		app.UseServices(services =&gt;</div><div class="line">		&#123;</div><div class="line">			services.AddSignalR();</div><div class="line">		&#125;);</div><div class="line">		app.UseFileServer();</div><div class="line">		app.UseSignalR();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>app.UserServices()</code>를 사용하기 위해서는 <code>Microsoft.AspNet.RequestContainer</code> assembly를 포함시켜야 <code>IApplicationBuilder</code>의 extention method인 <code>UseServices</code>의 사용이 가능한데, 현재 version에서는 <code>ASP.NET 4.5.1</code>을 지원하지 않아서 사용이 불가능 합니다.</p>
<p><a href="https://github.com/aspnet/Hosting/tree/8f16060f941b71551be09015d76efb86770d84d7/src/Microsoft.AspNet.RequestContainer" target="_blank" rel="external">https://github.com/aspnet/Hosting/tree/8f16060f941b71551be09015d76efb86770d84d7/src/Microsoft.AspNet.RequestContainer</a></p>
<p>위 Github repository의 <code>ContainerExtensions.cs</code>에 구현되어 있습니다.</p>
<p>추후에라도 적용시키기 위해서는 아래 Link를 참고하시기 바랍니다.</p>
<p><a href="http://dotnetthoughts.net/using-signalr-in-asp-net-5/" target="_blank" rel="external">http://dotnetthoughts.net/using-signalr-in-asp-net-5/</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2016/05/09/CSharp.AspnetCore.SignalR/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
            <a href="/2016/05/09/CSharp.AspnetCore.SignalR/">
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="undefined"/>
                </div>
            </a>
            
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Yun Seok-joon. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Yun Seok-joon</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Seoul, South Korea
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2015/11/10/Devops.Jenkins/">
                            <h3 class="media-heading">Install Jenkins</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 10, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.01.modeling/">
                            <h3 class="media-heading">SQLP 1-1 데이터 모델링</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.02.modeling_performance/">
                            <h3 class="media-heading">SQLP 1-2 데이터 모델과 성능</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/21/02.01.sql.basic/">
                            <h3 class="media-heading">SQLP 2-1 SQL 기본</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 21, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/23/02.02.sql.adv/">
                            <h3 class="media-heading">SQLP 2-2-1 SET, Hierarchical Query, Sub-query</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.03.group/">
                            <h3 class="media-heading">SQLP 2-2-2 GROUP function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.04.window/">
                            <h3 class="media-heading">SQLP 2-2-3 Window function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.05.dcl/">
                            <h3 class="media-heading">SQLP 2-2-4 DCL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.06.plsql/">
                            <h3 class="media-heading">SQLP 2-2-5 PL/SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/27/02.07.optimizer/">
                            <h3 class="media-heading">SQLP 2-3 Optimizing SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 27, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                59 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-kbuclmtqrwfmqogitsifpjr2mdxgukkqucv5th9u0chgrdjqgqfxwhpjxejt.min.js"></script>
<!--SCRIPTS END-->


    </body>
</html>
