
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Dev Star SJ">
    <title>WebSockets in .NET Core - Dev Star SJ</title>
    <meta name="author" content="Yun Seok-joon">
    
    
    
    <meta name="description" content=".NET Core (현재는 ASP.NET 5)로 간단한 Web Socket을 구현하는 예제코드와 설명입니다. 작업은 Visual Studio 2015 , ASP.NET5-rc1 으로 진행하였습니다. 개요 .NET Core (ASP.NET 5 Template)로 Web Application Project를 생성 Server : Echo Server 를 Web">
<meta name="keywords" content="C#,ASP.NET Core">
<meta property="og:type" content="blog">
<meta property="og:title" content="WebSockets in .NET Core">
<meta property="og:url" content="http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/index.html">
<meta property="og:site_name" content="Dev Star SJ">
<meta property="og:description" content=".NET Core (현재는 ASP.NET 5)로 간단한 Web Socket을 구현하는 예제코드와 설명입니다. 작업은 Visual Studio 2015 , ASP.NET5-rc1 으로 진행하였습니다. 개요 .NET Core (ASP.NET 5 Template)로 Web Application Project를 생성 Server : Echo Server 를 Web">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.01.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.02.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.03.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.04.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.06.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.07.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.05.png?raw=true">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.08.png?raw=true">
<meta property="og:updated_time" content="2017-04-23T10:32:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebSockets in .NET Core">
<meta name="twitter:description" content=".NET Core (현재는 ASP.NET 5)로 간단한 Web Socket을 구현하는 예제코드와 설명입니다. 작업은 Visual Studio 2015 , ASP.NET5-rc1 으로 진행하였습니다. 개요 .NET Core (ASP.NET 5 Template)로 Web Application Project를 생성 Server : Echo Server 를 Web">
<meta name="twitter:image" content="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.01.png?raw=true">
    
    
        
    
    
        <meta property="og:image" content="http://DevStarSJ.github.io/assets/images/sjyun.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-eoqrdyagg8lofwhg4unnxmhyxznbkxgjkodxgdtletmltlwb2wgngdrld76m.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Dev Star SJ</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Yun Seok-joon</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://DevLunaSJ.github.com/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.facebook.com/seokjoon.yun.9" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/u/1/108379332089647292574" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-google-plus"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/sjyun/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:seokjoon.yun@gmail.com" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            WebSockets in .NET Core
        </h1>
    
    
        <div class="post-meta">
    <time itemprop="datePublished" datetime="2016-05-11T00:00:00+09:00">
	
		    May 11, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/C/">C#</a>, <a class="category-link" href="/categories/C/ASP-NET-Core/">ASP.NET Core</a>


    
</div>

    
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p><code>.NET Core</code> (현재는 ASP.NET 5)로 간단한 Web Socket을 구현하는 예제코드와 설명입니다.</p>
<p>작업은 <code>Visual Studio 2015</code> , <code>ASP.NET5-rc1</code> 으로 진행하였습니다.</p>
<h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><ul>
<li><code>.NET Core</code> (ASP.NET 5 Template)로 Web Application Project를 생성</li>
<li>Server : Echo Server 를 Web Socket으로 구현<ul>
<li>Client에서 전달한 Text Message를 그대로 전달</li>
</ul>
</li>
<li>Client : jQuery를 이용한 간단한 Web Socket page를 생성</li>
<li>여러 Client가 접속한 경우 접속된 모든 Client에게 echo message를 전달</li>
</ul>
<h2 id="1-Project-생성"><a href="#1-Project-생성" class="headerlink" title="1. Project 생성"></a>1. Project 생성</h2><p><code>C#</code> -&gt; <code>Web</code> -&gt; <code>ASP.NET Web Application</code> 선택 후 <code>ASP.NET 5 Templates</code> -&gt; <code>Web Appliacaion</code>으로 Project를 생성합니다.<br><code>ASP.NET 5 Templates</code>가 설치되지 않은 경우 아래 설치 버튼이 활성화되며, 설치가 짧은 순간에 끝나지는 않으니 조금 기다리셔야 합니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.01.png?raw=true">  </p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.02.png?raw=true">  </p>
<h2 id="2-Server-Web-Socket-구현"><a href="#2-Server-Web-Socket-구현" class="headerlink" title="2. Server Web Socket 구현"></a>2. Server Web Socket 구현</h2><p><code>Startup.cs</code> 파일을 열어서 <code>public void Configure()</code> 함수에 아래 Code를 추가합니다.<br>단 <code>app.UseMvc()</code>보다 위에 위치해야 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">app.UseWebSockets();</div><div class="line">app.Use(async (http, next) =&gt;</div><div class="line">&#123;</div><div class="line">    if (http.WebSockets.IsWebSocketRequest)</div><div class="line">    &#123;</div><div class="line">        var webSocket = await http.WebSockets.AcceptWebSocketAsync();</div><div class="line"></div><div class="line">        if (webSocket != null &amp;&amp; webSocket.State == WebSocketState.Open)</div><div class="line">        &#123;</div><div class="line">            // Handle the socket here</div><div class="line">            while (webSocket.State == WebSocketState.Open)</div><div class="line">            &#123;</div><div class="line">                var token = CancellationToken.None;</div><div class="line">                var buffer = new ArraySegment&lt;byte&gt;(new byte[4096]);</div><div class="line"></div><div class="line">                var received = await webSocket.ReceiveAsync(buffer, token);</div><div class="line"></div><div class="line">                switch (received.MessageType)</div><div class="line">                &#123;</div><div class="line">                    case WebSocketMessageType.Text:</div><div class="line">                        var request = Encoding.UTF8.GetString(buffer.Array, buffer.Offset, buffer.Count);</div><div class="line"></div><div class="line">                        // Handle request here</div><div class="line">                        await webSocket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">                        break;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        await next();</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>위 Code가 실행되려면 Assembly를 하나 추가해 줘야합니다.</p>
<blockquote>
<p>“Microsoft.AspNet.WebSockets.Server”: “1.0.0-rc1-final”</p>
</blockquote>
<p><code>Nuget package manager</code>를 사용하지 않더라도 오류가 발생한 Code에서 <code>Ctrl + .</code> (Quick Action)을 이용하면 자동으로 추가가 됩니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.03.png?raw=true">  </p>
<p>또 필요한 <code>namespace</code>를 <code>using</code>에 추가를 해주는 작업도 <code>Ctrl +.</code>으로 쉽게 작업이 가능합니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.04.png?raw=true">  </p>
<p>Client에서 Connection을 연결할때마다 <code>app.Use</code>안에 선언한 함수가 실행됩니다.<br>Request가 아닌 경우에는 그냥 무시 (<code>next();</code>)를 하며 <code>Request</code>인 경우에는 <code>Accept</code>수행 후 <code>Receive</code>작업을 기다리며 Pending 상태가 됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var webSocket = await http.WebSockets.AcceptWebSocketAsync();</div><div class="line"></div><div class="line">if (webSocket != null &amp;&amp; webSocket.State == WebSocketState.Open)</div><div class="line">&#123;</div><div class="line">    while (webSocket.State == WebSocketState.Open)</div><div class="line">    &#123;</div><div class="line">        var token = CancellationToken.None;</div><div class="line">        var buffer = new ArraySegment&lt;byte&gt;(new byte[4096]);</div><div class="line"></div><div class="line">        var received = await webSocket.ReceiveAsync(buffer, token);</div><div class="line"></div><div class="line">        // Processing received message</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Message가 도착하면 <code>await webSocket.ReceiveAsync()</code>의 Pending이 해제되면서 다음 Line을 수행합니다.<br>현재 예제는 Text 타입에 대해서만 그대로 Client에게 echo message를 전달하고 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">switch (received.MessageType)</div><div class="line">&#123;</div><div class="line">    case WebSocketMessageType.Text:</div><div class="line">        await webSocket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">        break;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3-Client-Web-Socket-구현"><a href="#3-Client-Web-Socket-구현" class="headerlink" title="3. Client Web Socket 구현"></a>3. Client Web Socket 구현</h2><p>편의상 추가로 <code>Controller</code>를 추가하지 않고 <code>Home</code> Controller에 <code>Chat</code>이라는 <code>Action Method</code>를 추가하도록 하겠습니다.<br><code>Controllers/HomeController.cs</code>파일을 열어서 아래 Action을 추가해 주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public ActionResult Chat()</div><div class="line">&#123;</div><div class="line">    return View();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>아무런 내용없이 그냥 기본 Routing되는 View를 return합니다.</p>
<p><code>Views/Home</code> 폴더 아래에 <code>Chat.cshtml</code>파일을 추가해서 다음과 같이 입력해주세요.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@&#123;</div><div class="line">    ViewData["Title"] = "WebSocket Chat Page";</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"chatform"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"inputbox"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"message"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//code.jquery.com/jquery-1.11.0.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">var</span> username = prompt(<span class="string">'Enter your name: '</span>);</div><div class="line">        <span class="keyword">var</span> uri = <span class="string">'ws://localhost:9258'</span>;</div><div class="line">        <span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(uri);</div><div class="line"></div><div class="line">        ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            $(<span class="string">'#message'</span>).prepend(<span class="string">'&lt;div&gt;Connected.&lt;/div&gt;'</span>);</div><div class="line">            $(<span class="string">'#chatform'</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">                ws.send(<span class="string">'&lt;strong&gt;'</span> + username + <span class="string">' : &lt;/strong&gt;'</span> +$(<span class="string">'#inputbox'</span>).val());</div><div class="line">                $(<span class="string">'#inputbox'</span>).val(<span class="string">''</span>);</div><div class="line">                event.preventDefault();</div><div class="line">             &#125;);</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        ws.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">            $(<span class="string">'#message'</span>).prepend(<span class="string">'&lt;div&gt;ERROR&lt;/div&gt;'</span>);</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">            $(<span class="string">'#message'</span>).prepend(<span class="string">'&lt;div&gt;'</span> + event.data + <span class="string">'&lt;/div&gt;'</span>);</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>접속주소(<code>uri</code>) 값은 Server 실행시 port 번호를 보고 수정해 주세요.</li>
</ul>
<p><code>jQuery</code>를 nuget으로 설치해도 되지만 편의상 online으로 참조하였습니다.</p>
<ul>
<li>해당 View가 열릴때 <code>WebSocket()</code>으로 접속합니다.</li>
<li>접속에 성공하면 (<code>ws.onopen</code>) <code>chatform</code>의 <code>submit</code>작업으로 <code>ws.send()</code>를 실행하도록 설정합니다.</li>
<li><code>WebSocket</code>으로 부터 message를 전달받으면 (<code>ws,onmessage</code>)를 화면에 출력합니다.</li>
</ul>
<p>최대한 군더더기 없이 간단하게 구현하였습니다.</p>
<h2 id="4-실행"><a href="#4-실행" class="headerlink" title="4. 실행"></a>4. 실행</h2><p><code>F5</code>를 눌러서 <code>Debug</code> 수행후 접속주소에 <code>/Home/Chat</code>를 붙여서 우리가 생성한 View를 열어주세요.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.06.png?raw=true">  </p>
<p>이름을 입력해서 접속을 한 후에, 채팅 메세지를 입력하면 화면에 메세지가 출력됩니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.07.png?raw=true">  </p>
<p>위 메세지는 Client에서 출력을 한 것이 아니라 Server로 부터 전달받은 메세지 입니다.<br>믿기 힘드시겠다면, 여러 Client끼리 Chat을 할 수 있도록 Server를 수정해 보도록 하겠습니다.</p>
<h2 id="5-Server를-여러-Client에게-메세지-전달하도록-수정"><a href="#5-Server를-여러-Client에게-메세지-전달하도록-수정" class="headerlink" title="5. Server를 여러 Client에게 메세지 전달하도록 수정"></a>5. Server를 여러 Client에게 메세지 전달하도록 수정</h2><p><code>Startup.cs</code> 파일의 <code>public class Startup</code>에 thread-safety한 map을 하나 선언합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ConcurrentBag&lt;WebSocket&gt; _sockets = new ConcurrentBag&lt;WebSocket&gt;();</div></pre></td></tr></table></figure>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.05.png?raw=true">  </p>
<p>다음으로는 Client에서 접속시 <code>_sockets</code>에 socket들을 저장해 놓습니다.<br><code>// Handle the socket here</code> 바로 윗 부분에 아래 Code를 추가합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_sockets.Add(webSocket);</div></pre></td></tr></table></figure>
<p>Client에게 <code>SendAsync()</code>를 하는 부분을 전체 Client에게 전송하도록 수정합니다.<br><code>// Handle request here</code> 아래에 있는 <code>await webSocket.SendAsync()</code>줄을 지우고 아래 Code를 입력해주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">foreach (var socket in _sockets)</div><div class="line">&#123;</div><div class="line">    await socket.SendAsync(buffer, WebSocketMessageType.Text, true, token);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="6-실행"><a href="#6-실행" class="headerlink" title="6. 실행"></a>6. 실행</h2><p>이제 실행하여 Browser를 2개 띄워서 Test해보면 한 쪽에서 입력해도 양쪽으로 모두 메세지가 출력되는 것을 확인 할 수 있습니다.</p>
<p><img src="https://github.com/DevStarSJ/Study/raw/master/Blog/ASP.NET/ASP.NET.Core/WebSocket/image/ws5.08.png?raw=true">  </p>
<h2 id="참조-Site"><a href="#참조-Site" class="headerlink" title="참조 Site"></a>참조 Site</h2><ul>
<li>ASP.NET 5 Server Web Socket</li>
</ul>
<p><a href="&#x6d;&#x61;&#105;&#108;&#x74;&#111;&#58;&#x68;&#116;&#116;&#x70;&#x73;&#x3a;&#x2f;&#47;&#109;&#101;&#100;&#105;&#x75;&#109;&#x2e;&#99;&#x6f;&#109;&#47;&#64;&#x74;&#x75;&#114;&#111;&#119;&#105;&#99;&#x7a;&#x2f;&#119;&#x65;&#x62;&#115;&#111;&#x63;&#107;&#x65;&#x74;&#x73;&#x2d;&#105;&#110;&#45;&#x61;&#x73;&#112;&#x2d;&#x6e;&#101;&#x74;&#x2d;&#x35;&#45;&#54;&#48;&#x39;&#52;&#51;&#49;&#x39;&#x61;&#49;&#x35;&#97;&#x32;&#35;&#x2e;&#114;&#112;&#102;&#x74;&#x37;&#54;&#54;&#119;&#98;">&#x68;&#116;&#116;&#x70;&#x73;&#x3a;&#x2f;&#47;&#109;&#101;&#100;&#105;&#x75;&#109;&#x2e;&#99;&#x6f;&#109;&#47;&#64;&#x74;&#x75;&#114;&#111;&#119;&#105;&#99;&#x7a;&#x2f;&#119;&#x65;&#x62;&#115;&#111;&#x63;&#107;&#x65;&#x74;&#x73;&#x2d;&#105;&#110;&#45;&#x61;&#x73;&#112;&#x2d;&#x6e;&#101;&#x74;&#x2d;&#x35;&#45;&#54;&#48;&#x39;&#52;&#51;&#49;&#x39;&#x61;&#49;&#x35;&#97;&#x32;&#35;&#x2e;&#114;&#112;&#102;&#x74;&#x37;&#54;&#54;&#119;&#98;</a></p>
<ul>
<li>Client jQuery Web Socket</li>
</ul>
<p><a href="https://blogs.msdn.microsoft.com/youssefm/2012/07/17/building-real-time-web-apps-with-asp-net-webapi-and-websockets" target="_blank" rel="external">https://blogs.msdn.microsoft.com/youssefm/2012/07/17/building-real-time-web-apps-with-asp-net-webapi-and-websockets</a></p>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/ASP-NET-Core/">ASP.NET Core</a> <a class="tag tag--primary tag--small t-link" href="/tags/C/">C#</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/05/11/CSharp.AspnetCore.Install.Net.Core/"  data-tooltip=".NET Core Install for Ubuntu 14.04">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/05/11/CSharp.AspnetCore.Depoly.VS.Git/" data-tooltip="Deploying .NET Core Web App with Visual Studio and Git">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Yun Seok-joon. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/05/11/CSharp.AspnetCore.Install.Net.Core/"  data-tooltip=".NET Core Install for Ubuntu 14.04">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/05/11/CSharp.AspnetCore.Depoly.VS.Git/" data-tooltip="Deploying .NET Core Web App with Visual Studio and Git">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-twitter"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/05/11/CSharp.AspnetCore.WebSocket/">
                    <i class="fa fa-google-plus"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/sjyun.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Yun Seok-joon</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Seoul, South Korea
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2015/11/10/Devops.Jenkins/">
                            <h3 class="media-heading">Install Jenkins</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 10, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.01.modeling/">
                            <h3 class="media-heading">SQLP 1-1 데이터 모델링</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.02.modeling_performance/">
                            <h3 class="media-heading">SQLP 1-2 데이터 모델과 성능</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/21/02.01.sql.basic/">
                            <h3 class="media-heading">SQLP 2-1 SQL 기본</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 21, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/23/02.02.sql.adv/">
                            <h3 class="media-heading">SQLP 2-2-1 SET, Hierarchical Query, Sub-query</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.03.group/">
                            <h3 class="media-heading">SQLP 2-2-2 GROUP function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.04.window/">
                            <h3 class="media-heading">SQLP 2-2-3 Window function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.05.dcl/">
                            <h3 class="media-heading">SQLP 2-2-4 DCL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.06.plsql/">
                            <h3 class="media-heading">SQLP 2-2-5 PL/SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/27/02.07.optimizer/">
                            <h3 class="media-heading">SQLP 2-3 Optimizing SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 27, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                59 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-kbuclmtqrwfmqogitsifpjr2mdxgukkqucv5th9u0chgrdjqgqfxwhpjxejt.min.js"></script>
<!--SCRIPTS END-->

    


    </body>
</html>
