
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Dev Star SJ">
    <title>AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2) - Route - Dev Star SJ</title>
    <meta name="author" content="Yun Seok-joon">
    
    
    
    <meta name="description" content="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2)Routing 예제Web API를 구현하기 위해서는 여러가지 URL에 대해서 각각 다른 기능을 구현하는것은 필수적입니다.각각의 URL을 별도의 Lambda로 구현하여 API Gateway에서 연결하는 방법도 있지만 하나의 Lambda에서 처리하는 방법에 대해">
<meta name="keywords" content="Lambda,APIGateway,Node.JS,AWS">
<meta property="og:type" content="blog">
<meta property="og:title" content="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2) - Route">
<meta property="og:url" content="http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/index.html">
<meta property="og:site_name" content="Dev Star SJ">
<meta property="og:description" content="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2)Routing 예제Web API를 구현하기 위해서는 여러가지 URL에 대해서 각각 다른 기능을 구현하는것은 필수적입니다.각각의 URL을 별도의 Lambda로 구현하여 API Gateway에서 연결하는 방법도 있지만 하나의 Lambda에서 처리하는 방법에 대해">
<meta property="og:image" content="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/images/lambda_apigateway.route.01.png?raw=true">
<meta property="og:updated_time" content="2017-04-23T08:21:19.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2) - Route">
<meta name="twitter:description" content="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2)Routing 예제Web API를 구현하기 위해서는 여러가지 URL에 대해서 각각 다른 기능을 구현하는것은 필수적입니다.각각의 URL을 별도의 Lambda로 구현하여 API Gateway에서 연결하는 방법도 있지만 하나의 Lambda에서 처리하는 방법에 대해">
<meta name="twitter:image" content="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/images/lambda_apigateway.route.01.png?raw=true">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox-thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Dev Star SJ</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://DevLunaSJ.github.com/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.facebook.com/seokjoon.yun.9" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-facebook"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://plus.google.com/u/1/108379332089647292574" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-google-plus"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/sjyun/" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:seokjoon.yun@gmail.com" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2) - Route
        </h1>
    
    
        <div class="post-meta">
    <time itemprop="datePublished" datetime="2016-11-22T15:54:51+09:00">
	
		    Nov 22, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/AWS/">AWS</a>, <a class="category-link" href="/categories/AWS/Lambda/">Lambda</a>


    
</div>

    
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <h1 id="AWS-Lambda와-API-Gateway를-이용해서-Serverless-Web-API-만들기-2"><a href="#AWS-Lambda와-API-Gateway를-이용해서-Serverless-Web-API-만들기-2" class="headerlink" title="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2)"></a>AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (2)</h1><h2 id="Routing-예제"><a href="#Routing-예제" class="headerlink" title="Routing 예제"></a>Routing 예제</h2><p>Web API를 구현하기 위해서는 여러가지 URL에 대해서 각각 다른 기능을 구현하는것은 필수적입니다.<br>각각의 URL을 별도의 Lambda로 구현하여 API Gateway에서 연결하는 방법도 있지만 하나의 Lambda에서 처리하는 방법에 대해서 알아 보도록 하겠습니다.<br>이번에는 전편과는 다르게 약간의 설명을 하면서 진행하겠습니다.<br>전편의 내용을 안다는 가정하에 진행하겠습니다.<br>처음 이 글부터 보시는 분들은 아래 Link에서 내용을 숙지한 후에 진행해 주세요.</p>
<p><a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda%2BAPIGateWay.01.md" target="_blank" rel="external">https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda%2BAPIGateWay.01.md</a></p>
<h2 id="API-Gateway-설정"><a href="#API-Gateway-설정" class="headerlink" title="API Gateway 설정"></a>API Gateway 설정</h2><p>아래와 같이 API Gateway를 설정해 주세요.</p>
<p><img src="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/images/lambda_apigateway.route.01.png?raw=true"></p>
<p>1편에서 설정한 Path를 그대로 두셔도 되지만, <strong>ANY</strong> 에 대해서 연습할겸 모든 Resource, Method를 삭제한 후 다음 단계대로 추가해 주세요.</p>
<p><strong>ANY</strong>는 모든 http-method (GET, POST, PUT, DELETE, …) 를 모두 같은 Lambda로 연결하게 해주는 역할을 합니다.<br><strong>ANY</strong>와 같은 위치에 다른 method를 추가하면 그것을 제외한 나머지에 대해서만 <strong>ANY</strong>로 연결합니다.<br> (ex. <strong>ANY</strong>, <strong>GET</strong>을 같은 위치에 선언하면 <strong>GET</strong>을 제외한 나머지 연결에 대해서는 <strong>ANY</strong>가 처리)</p>
<ul>
<li><code>/</code>에서 <code>Actions</code> -&gt; <code>Create Method</code>를 눌러서 <code>ANY</code>를 생성</li>
<li><code>/</code>에서 <code>Actions</code> -&gt; <code>Create Resource</code>를 눌러서 <code>test</code>를 추가</li>
<li><code>/test</code>에서 <code>Actions</code> -&gt; <code>Create Resource</code>를 눌러서 <code>{userId}</code>를 추가</li>
<li><code>/{userId}</code>에서 <code>Actions</code> -&gt; <code>Create Method</code>를 눌러서 <code>ANY</code>를 생성</li>
</ul>
<p>위까지 한 다음에 <code>ANY</code>로 된 2 곳을 각각 눌러서</p>
<ul>
<li><strong>Integration type</strong> : <code>Lambda Function</code><ul>
<li><strong>Lambda Region</strong> : 람다를 생성한 지역 서버 선택</li>
<li><strong>Lambda Function</strong> : 람다 명칭 기입</li>
</ul>
</li>
<li><code>Save</code>를 누른 뒤 화면이 바뀌면</li>
<li><code>Integration Request</code> 선택<ul>
<li><code>Body Mapping Templates</code> 선택<ul>
<li><code>Add mapping template</code> 선택<ul>
<li><code>application/json</code>이라고 입력한 뒤 적용<ul>
<li><strong>Generate template</strong> : <code>Method Request passthrough</code> 선택</li>
<li><code>Save</code> 선택</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>API Gateway</strong>는 수정한 후 반드시 Deploy를 해주어야만 적용이 됩니다.<br><code>Actions</code> -&gt; <code>Deploy API</code>를 선택하면 <strong>Deployment stage</strong>를 입력하여야하는데 기존에 동일한 이름으로 하면 해당 설정을 덮어쓰게 되며,<br><code>[New Stage]</code>를 선택한 후 다른 이름을 입력하면 기존의 설정상태를 남겨둔체 새로운 이름으로 생성이 가능합니다.<br>앞에서의 예제에서 <strong>prod</strong>로 생성을 하였는데 이번에는 <code>test</code>로 생성해 보겠습니다.<br><code>[New Stage]</code>를 선택한 후 <code>test</code>를 입력하고 <code>Deploy</code> 버튼을 누릅니다.</p>
<p><code>Invoke URL</code>에 연결가능한 주소가 나오는데, 기존과 달라진 점이 마지막에 <strong>/prod</strong> 대신에 <strong>/test</strong>가 붙었다는것 밖에 없습니다.<br>브라우저에서 해당 주소로 접속을 하면 2가지 주소가 다 동작한다는 것이 확인됩니다.<br><strong>API Gateway</strong> 상에서도 <strong>Stages</strong> 메뉴로 들어가서 각각의 스테이징 명칭을 누르면 설정된 내용들을 볼 수 있습니다.</p>
<h2 id="Lambda-의-Node-JS-코드-수정"><a href="#Lambda-의-Node-JS-코드-수정" class="headerlink" title="Lambda 의 Node.JS 코드 수정"></a>Lambda 의 Node.JS 코드 수정</h2><p><strong>API Gateway</strong>에서 여러 경로로 들어오면 요청들을 모두 하나의 <strong>Lambda</strong>로 연결하였으니,<br>이젠 <strong>Lambda</strong> 상에서 여러 경로에 대해서 각각 다른 기능을 하도록 구현해보겠습니다.</p>
<p>가장 중요한 것이 어떤 경로(<code>resource-path</code>)로 들어왔는지 어떤 메서드(<code>http-method</code>)로 요청했는지에 대해서 알아야 합니다.<br><strong>JSON object</strong>로 전달된 <code>event</code> 안에 2가지 정보가 모두 있는데<br>각각의 위치가 <code>event.context.resource-path</code> 와 <code>event.context.http-method</code>에 있습니다.<br>그런데 <strong>-</strong>(dash)가 포함된 명칭이 있어서 <strong>.</strong>(dot)을 이용하여 읽으려면 오류가 발생하므로<br><code>event.context[&quot;resource-path&quot;]</code> , <code>event.context[&quot;http-method&quot;]</code> 식으로 접근해야 합니다.<br><strong>API Gateway</strong>에서의 template에서 <strong>-</strong>(dash)가 없는 명칭으로 수정한 뒤  <strong>.</strong>(dot)을 이용하여 읽어도 됩니다만<br>일단 여기서는 기본설정 그대로 진행하겠습니다.</p>
<p>3가지 경로에 대해서 각각 기능을 구현해보겠습니다.</p>
<ul>
<li><code>/</code>로 <code>GET</code> 요청 : 요청한 <strong>JSON Object</strong>를 그대로 응답</li>
<li><code>/test/{userId}</code>로 <code>GET</code> 요청 : <strong>{ id: userId, name: “test” }</strong>로 응답</li>
<li><code>/test/{userId}</code>로 <code>POST</code> 요청 : <strong>{ id: userId, header: header, body: body }</strong>로 응답</li>
</ul>
<p>먼저 위 3가지 기능에 대해서 각각 구현을 해보겠습니다.</p>
<p><code>/</code>로 <code>GET</code> 요청에 대해서는 앞 장에서 사용했던 코드 그대로 전달을 하면 됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;<span class="string">"event"</span> : event, <span class="string">"context"</span> : context&#125;;</div></pre></td></tr></table></figure>
<p><code>/test/{userId}</code>로 <code>GET</code>, <code>POST</code> 요청에 대해서는 각각 <code>get</code>, <code>post</code>라는 이름의 함수로 생성하겠습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">userId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">body</span>: &#123; <span class="attr">id</span>: userId, <span class="attr">name</span>: <span class="string">"test"</span> &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">userId, header, body</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">body</span>: &#123; <span class="attr">id</span>: userId, <span class="attr">header</span>: header, <span class="attr">body</span>: body &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>다음 순서로 위 3가지 기능을 담은 <strong>Map</strong>을 생성하겠습니다.<br><strong>JavaScript</strong>이기 때문에 그냥 간단하게 <strong>JSON Object</strong>형식으로 생성을 하면 됩니다.<br><code>event.context[&quot;resource-path&quot;]</code> -&gt; <code>event.context[&quot;http-method&quot;]</code> -&gt; <code>각각의 기능</code> 순서대로 접근하면 되도록 생성하였습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> routeMap = &#123;</div><div class="line">  <span class="string">'/'</span>: &#123;</div><div class="line">    <span class="string">'GET'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">let</span>  result = &#123;<span class="string">"event"</span> : event, <span class="string">"context"</span> : context&#125;</div><div class="line">      <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">'/test/&#123;userId&#125;'</span>: &#123;</div><div class="line">    <span class="string">'GET'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> userId = event.params.path.userId;</div><div class="line">      <span class="keyword">return</span> get(userId);</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'POST'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> userId = event.params.path.userId;</div><div class="line">      <span class="keyword">const</span> body = <span class="built_in">JSON</span>.stringify(event[<span class="string">"body-json"</span>]);</div><div class="line">      <span class="keyword">const</span> header =  event.params.header;</div><div class="line">      <span class="keyword">return</span> post(userId, header, body);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>이제 실질적으로 <strong>Router</strong>기능을 수행하는 함수를 생성해 보겠습니다.<br><code>event</code>와 <code>context</code>를 전달받아 <code>routeMap</code>에서 해당 기능들을 수행하고 그 결과를 다시 전달하는게 이 함수 기능의 전부입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">router</span>(<span class="params">event, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> controller = routeMap[event.context[<span class="string">"resource-path"</span>]][event.context[<span class="string">"http-method"</span>]];</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(!controller) &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">body</span>: &#123; <span class="attr">Error</span>: <span class="string">"Invalid Path"</span> &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> controller(event, context);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>이제 모든 기능 구현은 끝났습니다.<br><strong>Lambda</strong>의 진입점인 <code>exports.handler</code>에서 <code>router</code> 함수를 호출해주기만 하면 됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">exports.handler = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</div><div class="line">   <span class="keyword">let</span> result = router(event, context);</div><div class="line">   callback(<span class="literal">null</span>, result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="전체-코드"><a href="#전체-코드" class="headerlink" title="전체 코드"></a>전체 코드</h3><p>앞에 설명한 내용들을 실제 소스코드로 작성하면 아래와 같이 됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">userId</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">body</span>: &#123; <span class="attr">id</span>: userId, <span class="attr">name</span>: <span class="string">"test"</span> &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params">userId, header, body</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">body</span>: &#123; <span class="attr">id</span>: userId, <span class="attr">header</span>: header, <span class="attr">body</span>: body &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> routeMap = &#123;</div><div class="line">  <span class="string">'/'</span>: &#123;</div><div class="line">    <span class="string">'GET'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">let</span>  result = &#123;<span class="string">"event"</span> : event, <span class="string">"context"</span> : context&#125;</div><div class="line">      <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">'/test/&#123;userId&#125;'</span>: &#123;</div><div class="line">    <span class="string">'GET'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> userId = event.params.path.userId;</div><div class="line">      <span class="keyword">return</span> get(userId);</div><div class="line">    &#125;,</div><div class="line">    <span class="string">'POST'</span>: <span class="function">(<span class="params">event, context</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> userId = event.params.path.userId;</div><div class="line">      <span class="keyword">const</span> body = <span class="built_in">JSON</span>.stringify(event[<span class="string">"body-json"</span>]);</div><div class="line">      <span class="keyword">const</span> header =  event.params.header;</div><div class="line">      <span class="keyword">return</span> post(userId, header, body);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">router</span>(<span class="params">event, context</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> controller = routeMap[event.context[<span class="string">"resource-path"</span>]][event.context[<span class="string">"http-method"</span>]];</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(!controller) &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">body</span>: &#123; <span class="attr">Error</span>: <span class="string">"Invalid Path"</span> &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> controller(event, context);</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.handler = <span class="function">(<span class="params">event, context, callback</span>) =&gt;</span> &#123;</div><div class="line">   <span class="keyword">let</span> result = router(event, context);</div><div class="line">   callback(<span class="literal">null</span>, result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Lambda</strong>에 위 코드를 입력한 후 저장하면 됩니다.</p>
<h2 id="결과-확인"><a href="#결과-확인" class="headerlink" title="결과 확인"></a>결과 확인</h2><p> <strong>API Gateway</strong>의 <strong>Invoke URL</strong>을 이용하여 호출하여 그 결과값을 확인해 보겠습니다.</p>
<ul>
<li><p><code>/</code>로 <code>GET</code> 요청 : <strong>Invoke URL</strong> 을 브라우저에 입력 </p>
<p>요청 JSON을 그대로 응답한 것으로, 앞장에서 살펴본 예제의 결과와 동일하게 나옵니다.</p>
</li>
<li><p><code>/test/{userId}</code>로 <code>GET</code> 요청 : <strong>Invoke URL</strong>에 <code>/test/LunaStar</code>를 붙여서 브라우저에 입력</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"body"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"LunaStar"</span>,</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"test"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><code>/test/{userId}</code>로 <code>POST</code> 요청 : <strong>POSTMAN</strong>에서 <strong>Invoke URL</strong>에 <code>/test/LunaStar</code>를 붙이고 적당히 header, body를 입력하여 요청</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  "body": &#123;</div><div class="line">    "id": "LunaStar",</div><div class="line">    "header": &#123;</div><div class="line">      ...</div><div class="line">    &#125;,</div><div class="line">    "body": "&#123;\"id\":\"123\",\"age\":\"25\"&#125;"</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="마치며…"><a href="#마치며…" class="headerlink" title="마치며…"></a>마치며…</h3><p>이번 포스팅에서 알아본 내용들은 다음과 같습니다.</p>
<ul>
<li><strong>API Gateway</strong>에서 <strong>ANY</strong>를 이용해서 여러가지 <strong>http-method</strong> 요청을 하나의 <strong>Lambda</strong>로 요청하는 방법</li>
<li><strong>API Gateway</strong>에서 <strong>Staging</strong>을 나누어 <strong>Deploy</strong>하여 각각의 <strong>Staging</strong>으로 접근하는 방법</li>
<li><strong>Lambda</strong>내에서 요청한 <strong>URL</strong> 및 <strong>http-method</strong> 별로 다른 작업을 하는 <strong>Node.JS</strong> 코드 작성법 </li>
</ul>
<p>잘못되었거나, 변경된 점, 기타 추가 사항에 대한 피드백은 언제나 환영합니다. - <a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#115;&#x65;&#111;&#x6b;&#x6a;&#x6f;&#111;&#110;&#x2e;&#x79;&#x75;&#110;&#64;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;">&#115;&#x65;&#111;&#x6b;&#x6a;&#x6f;&#111;&#110;&#x2e;&#x79;&#x75;&#110;&#64;&#103;&#109;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;</a></p>
<h3 id="다음글"><a href="#다음글" class="headerlink" title="다음글"></a>다음글</h3><ul>
<li>Lambda 와 API Gateway 연동 #3 (Proxy Resource) : <a href="https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda%2BAPIGateway.03.Proxy.md" target="_blank" rel="external">https://github.com/DevStarSJ/Study/blob/master/Blog/Cloud/AWS/Lambda%2BAPIGateway.03.Proxy.md</a></li>
</ul>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/APIGateway/">APIGateway</a> <a class="tag tag--primary tag--small t-link" href="/tags/AWS/">AWS</a> <a class="tag tag--primary tag--small t-link" href="/tags/Lambda/">Lambda</a> <a class="tag tag--primary tag--small t-link" href="/tags/Node-JS/">Node.JS</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/11/22/Lambda+APIGateWay.01/"  data-tooltip="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/11/22/Lambda+APIGateway.03.Proxy/" data-tooltip="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (3) - Proxy">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Yun Seok-joon. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/11/22/Lambda+APIGateWay.01/"  data-tooltip="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/11/22/Lambda+APIGateway.03.Proxy/" data-tooltip="AWS Lambda와 API Gateway를 이용해서 Serverless Web API 만들기 (3) - Proxy">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-twitter"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://DevStarSJ.github.io/2016/11/22/Lambda+APIGateway.02.Route/">
                    <i class="fa fa-google-plus"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Yun Seok-joon</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Seoul, South Korea
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2015/11/10/Devops.Jenkins/">
                            <h3 class="media-heading">Install Jenkins</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Nov 10, 2015
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.01.modeling/">
                            <h3 class="media-heading">SQLP 1-1 데이터 모델링</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/20/01.02.modeling_performance/">
                            <h3 class="media-heading">SQLP 1-2 데이터 모델과 성능</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 20, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/21/02.01.sql.basic/">
                            <h3 class="media-heading">SQLP 2-1 SQL 기본</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 21, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/23/02.02.sql.adv/">
                            <h3 class="media-heading">SQLP 2-2-1 SET, Hierarchical Query, Sub-query</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.03.group/">
                            <h3 class="media-heading">SQLP 2-2-2 GROUP function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/25/02.04.window/">
                            <h3 class="media-heading">SQLP 2-2-3 Window function</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 25, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.05.dcl/">
                            <h3 class="media-heading">SQLP 2-2-4 DCL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/26/02.06.plsql/">
                            <h3 class="media-heading">SQLP 2-2-5 PL/SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 26, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://DevStarSJ.github.io/2016/01/27/02.07.optimizer/">
                            <h3 class="media-heading">SQLP 2-3 Optimizing SQL</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jan 27, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                59 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/jquery.fancybox-thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    


    </body>
</html>
